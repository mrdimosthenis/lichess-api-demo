var LichessDemo=function(){"use strict";const e={createElement:function(e,t){return document.createElement(e,t)},createElementNS:function(e,t,n){return document.createElementNS(e,t,n)},createTextNode:function(e){return document.createTextNode(e)},createDocumentFragment:function(){return document.createDocumentFragment()},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,n){e.insertBefore(t,n)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},getTextContent:function(e){return e.textContent},isElement:function(e){return 1===e.nodeType},isText:function(e){return 3===e.nodeType},isComment:function(e){return 8===e.nodeType},isDocumentFragment:function(e){return 11===e.nodeType}};function t(e,t,n,r,o){return{sel:e,data:t,children:n,text:r,elm:o,key:void 0===t?void 0:t.key}}const n=Array.isArray;function r(e){return"string"==typeof e||"number"==typeof e||e instanceof String||e instanceof Number}function o(e){return void 0===e}function i(e){return void 0!==e}const s=t("",{},[],void 0,void 0);function a(e,t){var n,r;const o=e.key===t.key,i=(null===(n=e.data)||void 0===n?void 0:n.is)===(null===(r=t.data)||void 0===r?void 0:r.is);return e.sel===t.sel&&o&&i}function c(){throw new Error("The document fragment is not supported on this platform.")}function l(e,t,n){var r;const o={};for(let i=t;i<=n;++i){const t=null===(r=e[i])||void 0===r?void 0:r.key;void 0!==t&&(o[t]=i)}return o}const u=["create","update","remove","destroy","pre","post"];function h(h,d,p){const f={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},m=void 0!==d?d:e;for(const e of u)for(const t of h){const n=t[e];void 0!==n&&f[e].push(n)}function g(e){const n=e.id?"#"+e.id:"",r=e.getAttribute("class"),o=r?"."+r.split(" ").join("."):"";return t(m.tagName(e).toLowerCase()+n+o,{},[],void 0,e)}function v(e){return t(void 0,{},[],void 0,e)}function b(e,t){return function(){if(0==--t){const t=m.parentNode(e);m.removeChild(t,e)}}}function w(e,t){var a,l,u,h;let d,g=e.data;if(void 0!==g){const t=null===(a=g.hook)||void 0===a?void 0:a.init;i(t)&&(t(e),g=e.data)}const v=e.children,b=e.sel;if("!"===b)o(e.text)&&(e.text=""),e.elm=m.createComment(e.text);else if(void 0!==b){const o=b.indexOf("#"),a=b.indexOf(".",o),c=o>0?o:b.length,u=a>0?a:b.length,h=-1!==o||-1!==a?b.slice(0,Math.min(c,u)):b,p=e.elm=i(g)&&i(d=g.ns)?m.createElementNS(d,h,g):m.createElement(h,g);for(c<u&&p.setAttribute("id",b.slice(c+1,u)),a>0&&p.setAttribute("class",b.slice(u+1).replace(/\./g," ")),d=0;d<f.create.length;++d)f.create[d](s,e);if(n(v))for(d=0;d<v.length;++d){const e=v[d];null!=e&&m.appendChild(p,w(e,t))}else r(e.text)&&m.appendChild(p,m.createTextNode(e.text));const y=e.data.hook;i(y)&&(null===(l=y.create)||void 0===l||l.call(y,s,e),y.insert&&t.push(e))}else if((null===(u=null==p?void 0:p.experimental)||void 0===u?void 0:u.fragments)&&e.children){const n=e.children;for(e.elm=(null!==(h=m.createDocumentFragment)&&void 0!==h?h:c)(),d=0;d<f.create.length;++d)f.create[d](s,e);for(d=0;d<n.length;++d){const r=n[d];null!=r&&m.appendChild(e.elm,w(r,t))}}else e.elm=m.createTextNode(e.text);return e.elm}function y(e,t,n,r,o,i){for(;r<=o;++r){const o=n[r];null!=o&&m.insertBefore(e,w(o,i),t)}}function k(e){var t,n;const r=e.data;if(void 0!==r){null===(n=null===(t=null==r?void 0:r.hook)||void 0===t?void 0:t.destroy)||void 0===n||n.call(t,e);for(let t=0;t<f.destroy.length;++t)f.destroy[t](e);if(void 0!==e.children)for(let t=0;t<e.children.length;++t){const n=e.children[t];null!=n&&"string"!=typeof n&&k(n)}}}function E(e,t,n,r){for(var o,s;n<=r;++n){let r,a;const c=t[n];if(null!=c)if(i(c.sel)){k(c),r=f.remove.length+1,a=b(c.elm,r);for(let e=0;e<f.remove.length;++e)f.remove[e](c,a);const e=null===(s=null===(o=null==c?void 0:c.data)||void 0===o?void 0:o.hook)||void 0===s?void 0:s.remove;i(e)?e(c,a):a()}else m.removeChild(e,c.elm)}}function _(e,t,n){var r,s,c,u,h;const d=null===(r=t.data)||void 0===r?void 0:r.hook;null===(s=null==d?void 0:d.prepatch)||void 0===s||s.call(d,e,t);const p=t.elm=e.elm,g=e.children,v=t.children;if(e!==t){if(void 0!==t.data){for(let n=0;n<f.update.length;++n)f.update[n](e,t);null===(u=null===(c=t.data.hook)||void 0===c?void 0:c.update)||void 0===u||u.call(c,e,t)}o(t.text)?i(g)&&i(v)?g!==v&&function(e,t,n,r){let i,s,c,u,h=0,d=0,p=t.length-1,f=t[0],g=t[p],v=n.length-1,b=n[0],k=n[v];for(;h<=p&&d<=v;)null==f?f=t[++h]:null==g?g=t[--p]:null==b?b=n[++d]:null==k?k=n[--v]:a(f,b)?(_(f,b,r),f=t[++h],b=n[++d]):a(g,k)?(_(g,k,r),g=t[--p],k=n[--v]):a(f,k)?(_(f,k,r),m.insertBefore(e,f.elm,m.nextSibling(g.elm)),f=t[++h],k=n[--v]):a(g,b)?(_(g,b,r),m.insertBefore(e,g.elm,f.elm),g=t[--p],b=n[++d]):(void 0===i&&(i=l(t,h,p)),s=i[b.key],o(s)?m.insertBefore(e,w(b,r),f.elm):(c=t[s],c.sel!==b.sel?m.insertBefore(e,w(b,r),f.elm):(_(c,b,r),t[s]=void 0,m.insertBefore(e,c.elm,f.elm))),b=n[++d]);d<=v&&(u=null==n[v+1]?null:n[v+1].elm,y(e,u,n,d,v,r)),h<=p&&E(e,t,h,p)}(p,g,v,n):i(v)?(i(e.text)&&m.setTextContent(p,""),y(p,null,v,0,v.length-1,n)):i(g)?E(p,g,0,g.length-1):i(e.text)&&m.setTextContent(p,""):e.text!==t.text&&(i(g)&&E(p,g,0,g.length-1),m.setTextContent(p,t.text)),null===(h=null==d?void 0:d.postpatch)||void 0===h||h.call(d,e,t)}}return function(e,t){let n,r,o;const i=[];for(n=0;n<f.pre.length;++n)f.pre[n]();for(!function(e,t){return e.isElement(t)}(m,e)?function(e,t){return e.isDocumentFragment(t)}(m,e)&&(e=v(e)):e=g(e),a(e,t)?_(e,t,i):(r=e.elm,o=m.parentNode(r),w(t,i),null!==o&&(m.insertBefore(o,t.elm,m.nextSibling(r)),E(o,[e],0,0))),n=0;n<i.length;++n)i[n].data.hook.insert(i[n]);for(n=0;n<f.post.length;++n)f.post[n]();return t}}function d(e,t,n){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==t)for(let e=0;e<t.length;++e){const n=t[e];if("string"==typeof n)continue;const r=n.data;void 0!==r&&d(r,n.children,n.sel)}}function p(e,o,i){let s,a,c,l={};if(void 0!==i?(null!==o&&(l=o),n(i)?s=i:r(i)?a=i.toString():i&&i.sel&&(s=[i])):null!=o&&(n(o)?s=o:r(o)?a=o.toString():o&&o.sel?s=[o]:l=o),void 0!==s)for(c=0;c<s.length;++c)r(s[c])&&(s[c]=t(void 0,void 0,void 0,s[c],void 0));return"s"!==e[0]||"v"!==e[1]||"g"!==e[2]||3!==e.length&&"."!==e[3]&&"#"!==e[3]||d(l,s,e),t(e,l,s,a,void 0)}function f(e,t){let n;const r=t.elm;let o=e.data.attrs,i=t.data.attrs;if((o||i)&&o!==i){for(n in o=o||{},i=i||{},i){const e=i[n];o[n]!==e&&(!0===e?r.setAttribute(n,""):!1===e?r.removeAttribute(n):120!==n.charCodeAt(0)?r.setAttribute(n,e):58===n.charCodeAt(3)?r.setAttributeNS("http://www.w3.org/XML/1998/namespace",n,e):58===n.charCodeAt(5)?r.setAttributeNS("http://www.w3.org/1999/xlink",n,e):r.setAttribute(n,e))}for(n in o)n in i||r.removeAttribute(n)}}const m={create:f,update:f};function g(e,t){let n,r;const o=t.elm;let i=e.data.class,s=t.data.class;if((i||s)&&i!==s){for(r in i=i||{},s=s||{},i)i[r]&&!Object.prototype.hasOwnProperty.call(s,r)&&o.classList.remove(r);for(r in s)n=s[r],n!==i[r]&&o.classList[n?"add":"remove"](r)}}const v={create:g,update:g};function b(e,t,n){if("function"==typeof e)e.call(t,n,t);else if("object"==typeof e)for(let r=0;r<e.length;r++)b(e[r],t,n)}function w(e,t){const n=e.type,r=t.data.on;r&&r[n]&&b(r[n],t,e)}function y(e,t){const n=e.data.on,r=e.listener,o=e.elm,i=t&&t.data.on,s=t&&t.elm;let a;if(n!==i){if(n&&r)if(i)for(a in n)i[a]||o.removeEventListener(a,r,!1);else for(a in n)o.removeEventListener(a,r,!1);if(i){const r=t.listener=e.listener||function e(t){w(t,e.vnode)};if(r.vnode=t,n)for(a in i)n[a]||s.addEventListener(a,r,!1);else for(a in i)s.addEventListener(a,r,!1)}}}const k={create:y,update:y,destroy:y};var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function _(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var x={};!function(e){var t,n=E&&E.__extends||(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},t(e,n)},function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}),r=E&&E.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=E&&E.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=E&&E.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},s=E&&E.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r};Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function e(){}return e.prototype.toString=function(){return"ErrorOAuth2"},e}();e.ErrorOAuth2=a;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorUnknown"},t}(a);e.ErrorUnknown=c;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorNoAuthCode"},t}(a);e.ErrorNoAuthCode=l;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorInvalidReturnedStateParam"},t}(a);e.ErrorInvalidReturnedStateParam=u;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorInvalidJson"},t}(a);e.ErrorInvalidJson=h;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorInvalidScope"},t}(a);e.ErrorInvalidScope=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorInvalidRequest"},t}(a);e.ErrorInvalidRequest=p;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorInvalidToken"},t}(a);e.ErrorInvalidToken=f;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorAuthenticationGrant"},t}(a);e.ErrorAuthenticationGrant=m;var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorUnauthorizedClient"},t}(m);e.ErrorUnauthorizedClient=g;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorAccessDenied"},t}(m);e.ErrorAccessDenied=v;var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorUnsupportedResponseType"},t}(m);e.ErrorUnsupportedResponseType=b;var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorServerError"},t}(m);e.ErrorServerError=w;var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorTemporarilyUnavailable"},t}(m);e.ErrorTemporarilyUnavailable=y;var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorAccessTokenResponse"},t}(a);e.ErrorAccessTokenResponse=k;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorInvalidClient"},t}(k);e.ErrorInvalidClient=_;var x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorInvalidGrant"},t}(k);e.ErrorInvalidGrant=x;var C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.toString=function(){return"ErrorUnsupportedGrantType"},t}(k);e.ErrorUnsupportedGrantType=C;var S=function(){this.realm="",this.error=""};function A(t){return new(e.RawErrorToErrorClassMap[t]||c)}function O(e){var t=e.slice("Bearer ".length).replace(/"/g,"").split(", ").map((function(e){var t,n=e.split("="),r=n[0],o=n[1];return(t={})[r]=o,t})).reduce((function(e,t){return r(r({},e),t)}),{});return{realm:t.realm,error:t.error}}e.ErrorWWWAuthenticate=S,e.RawErrorToErrorClassMap={invalid_request:p,invalid_grant:x,unauthorized_client:g,access_denied:v,unsupported_response_type:b,invalid_scope:d,server_error:w,temporarily_unavailable:y,invalid_client:_,unsupported_grant_type:C,invalid_json:h,invalid_token:f},e.toErrorClass=A,e.fromWWWAuthenticateHeaderStringToObject=O;var T="WWW-Authenticate";e.LOCALSTORAGE_ID="oauth2authcodepkce",e.LOCALSTORAGE_STATE=e.LOCALSTORAGE_ID+"-state",e.RECOMMENDED_CODE_VERIFIER_LENGTH=96,e.RECOMMENDED_STATE_LENGTH=32;var P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",R=function(){function t(e){return this.state={},this.config=e,this.recoverState(),this}return t.prototype.decorateFetchHTTPClient=function(e){var t=this;return function(n,r){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];return t.state.isHTTPDecoratorActive?t.getAccessToken().then((function(t){var i=t.token,a=Object.assign({},r);return a.headers||(a.headers={}),a.headers.Authorization="Bearer "+i.value,e.apply(void 0,s([n,a],o))})).then((function(e){if(e.ok)return e;if(!e.headers.has(T.toLowerCase()))return e;var n=A(O(e.headers.get(T.toLowerCase())).error);return n instanceof f&&t.config.onAccessTokenExpiry((function(){return t.exchangeRefreshTokenForAccessToken()})),Promise.reject(n)})):e.apply(void 0,s([n,r],o))}},t.prototype.isReturningFromAuthServer=function(){var n=t.extractParamFromUrl(location.href,"error");if(n)return Promise.reject(A(n));var r=t.extractParamFromUrl(location.href,"code");if(!r)return Promise.resolve(!1);var o=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}");return t.extractParamFromUrl(location.href,"state")!==o.stateQueryParam?(console.warn("state query string parameter doesn't match the one sent! Possible malicious activity somewhere."),Promise.reject(new u)):(o.authorizationCode=r,o.hasAuthCodeBeenExchangedForAccessToken=!1,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(o)),this.setState(o),Promise.resolve(!0))},t.prototype.fetchAuthorizationCode=function(n){return o(this,void 0,void 0,(function(){var o,s,a,c,l,u,h,d,p,f,m;return i(this,(function(i){switch(i.label){case 0:return this.assertStateAndConfigArePresent(),o=this.config,s=o.clientId,a=o.extraAuthorizationParams,c=o.redirectUrl,l=o.scopes,[4,t.generatePKCECodes()];case 1:return u=i.sent(),h=u.codeChallenge,d=u.codeVerifier,p=t.generateRandomState(e.RECOMMENDED_STATE_LENGTH),this.state=r(r({},this.state),{codeChallenge:h,codeVerifier:d,stateQueryParam:p,isHTTPDecoratorActive:!0}),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state)),f=this.config.authorizationUrl+"?response_type=code&client_id="+encodeURIComponent(s)+"&redirect_uri="+encodeURIComponent(c)+"&scope="+encodeURIComponent(l.join(" "))+"&state="+p+"&code_challenge="+encodeURIComponent(h)+"&code_challenge_method=S256",(a||n)&&(m=r(r({},a),n),f=f+"&"+t.objectToQueryString(m)),location.replace(f),[2]}}))}))},t.prototype.getAccessToken=function(){var e=this;this.assertStateAndConfigArePresent();var t=this.config.onAccessTokenExpiry,n=this.state,r=n.accessToken,o=n.authorizationCode,i=n.explicitlyExposedTokens,s=n.hasAuthCodeBeenExchangedForAccessToken,a=n.refreshToken,c=n.scopes;return o?this.authCodeForAccessTokenRequest?this.authCodeForAccessTokenRequest:this.isAuthorized()&&s?a&&this.isAccessTokenExpired()?t((function(){return e.exchangeRefreshTokenForAccessToken()})):Promise.resolve({token:r,explicitlyExposedTokens:i,scopes:c,refreshToken:a}):(this.authCodeForAccessTokenRequest=this.exchangeAuthCodeForAccessToken(),this.authCodeForAccessTokenRequest):Promise.reject(new l)},t.prototype.exchangeRefreshTokenForAccessToken=function(){var n,r=this;this.assertStateAndConfigArePresent();var o=this.config,i=o.extraRefreshParams,s=o.clientId,a=o.tokenUrl,c=this.state.refreshToken;c||console.warn("No refresh token is present.");var l=a,u="grant_type=refresh_token&refresh_token="+(null===(n=c)||void 0===n?void 0:n.value)+"&client_id="+s;return i&&(u=l+"&"+t.objectToQueryString(i)),fetch(l,{method:"POST",body:u,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.status>=400?e.json().then((function(e){return Promise.reject(e)})):e.json()})).then((function(t){var n=t.access_token,o=t.expires_in,i=t.refresh_token,s=t.scope,a=r.config.explicitlyExposedTokens,c=[],l={},u={value:n,expiry:new Date(Date.now()+1e3*parseInt(o)).toString()};if(r.state.accessToken=u,i){var h={value:i};r.state.refreshToken=h}a&&(l=Object.fromEntries(a.map((function(e){return[e,t[e]]})).filter((function(e){return e[0],void 0!==e[1]}))),r.state.explicitlyExposedTokens=l),s&&(c=s.split(" "),r.state.scopes=c),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(r.state));var d={token:u,scopes:c};return a&&(d.explicitlyExposedTokens=l),d})).catch((function(e){var t=r.config.onInvalidGrant,n=e.error||"There was a network error.";if("invalid_grant"===n)t((function(){return r.fetchAuthorizationCode()}));return Promise.reject(A(n))}))},t.prototype.getGrantedScopes=function(){return this.state.scopes},t.prototype.isHTTPDecoratorActive=function(t){this.state.isHTTPDecoratorActive=t,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state))},t.prototype.isAuthorized=function(){return!!this.state.accessToken},t.prototype.isAccessTokenExpired=function(){var e=this.state.accessToken;return Boolean(e&&new Date>=new Date(e.expiry))},t.prototype.reset=function(){this.setState({}),this.authCodeForAccessTokenRequest=void 0},t.prototype.assertStateAndConfigArePresent=function(){if(!this.state||!this.config)throw console.error("state:",this.state,"config:",this.config),new Error("state or config is not set.")},t.prototype.exchangeAuthCodeForAccessToken=function(t){var n=this;this.assertStateAndConfigArePresent();var r=this.state,o=r.authorizationCode,i=void 0===o?t:o,s=r.codeVerifier,a=void 0===s?"":s,c=this.config,l=c.clientId,u=c.onInvalidGrant,h=c.redirectUrl;a?i||console.warn("No authorization grant code is being passed."):console.warn("No code verifier is being sent.");var d=this.config.tokenUrl,p="grant_type=authorization_code&code="+encodeURIComponent(i||"")+"&redirect_uri="+encodeURIComponent(h)+"&client_id="+encodeURIComponent(l)+"&code_verifier="+a;return fetch(d,{method:"POST",body:p,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){var r=t.json().catch((function(e){return{error:"invalid_json"}}));return t.ok?r.then((function(t){var r=t.access_token,o=t.expires_in,i=t.refresh_token,s=t.scope,a=n.config.explicitlyExposedTokens,c=[],l={};n.state.hasAuthCodeBeenExchangedForAccessToken=!0,n.authCodeForAccessTokenRequest=void 0;var u={value:r,expiry:new Date(Date.now()+1e3*parseInt(o)).toString()};if(n.state.accessToken=u,i){var h={value:i};n.state.refreshToken=h}a&&(l=Object.fromEntries(a.map((function(e){return[e,t[e]]})).filter((function(e){return e[0],void 0!==e[1]}))),n.state.explicitlyExposedTokens=l),s&&(c=s.split(" "),n.state.scopes=c),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(n.state));var d={token:u,scopes:c};return a&&(d.explicitlyExposedTokens=l),d})):r.then((function(e){var t=e.error;if("invalid_grant"===t)u((function(){return n.fetchAuthorizationCode()}));return Promise.reject(A(t))}))}))},t.prototype.recoverState=function(){return this.state=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),this},t.prototype.setState=function(t){return this.state=t,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(t)),this},t.base64urlEncode=function(e){var t=btoa(e);return t=(t=(t=t.replace(/\+/g,"-")).replace(/\//g,"_")).replace(/=/g,"")},t.extractParamFromUrl=function(e,t){var n=e.split("?");if(n.length<2)return"";var r=(n=n[1].split("#"))[0].split("&").reduce((function(e,t){return e.concat(t.split("="))}),[]);if(r.length<2)return"";var o=r.indexOf(t);return decodeURIComponent(o>=0?r[o+1]:"")},t.objectToQueryString=function(e){return Object.entries(e).map((function(e){var t=e[0],n=e[1];return t+"="+encodeURIComponent(n)})).join("&")},t.generatePKCECodes=function(){var n=new Uint32Array(e.RECOMMENDED_CODE_VERIFIER_LENGTH);crypto.getRandomValues(n);var r=t.base64urlEncode(Array.from(n).map((function(e){return P[e%P.length]})).join(""));return crypto.subtle.digest("SHA-256",(new TextEncoder).encode(r)).then((function(e){for(var t=new Uint8Array(e),n="",r=t.byteLength,o=0;o<r;o++)n+=String.fromCharCode(t[o]);return n})).then(t.base64urlEncode).then((function(e){return{codeChallenge:e,codeVerifier:r}}))},t.generateRandomState=function(e){var t=new Uint32Array(e);return crypto.getRandomValues(t),Array.from(t).map((function(e){return P[e%P.length]})).join("")},t}();e.OAuth2AuthCodePKCE=R}(x);var C=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},S=$,A=M,O=function(e){return q(M(e))},T=q,P=I,R=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function M(e){for(var t,n=[],r=0,o=0,i="";null!=(t=R.exec(e));){var s=t[0],a=t[1],c=t.index;if(i+=e.slice(o,c),o=c+s.length,a)i+=a[1];else{i&&(n.push(i),i="");var l=t[2],u=t[3],h=t[4],d=t[5],p=t[6],f=t[7],m="+"===p||"*"===p,g="?"===p||"*"===p,v=l||"/",b=h||d||(f?".*":"[^"+v+"]+?");n.push({name:u||r++,prefix:l||"",delimiter:v,optional:g,repeat:m,pattern:j(b)})}}return o<e.length&&(i+=e.substr(o)),i&&n.push(i),n}function q(e){for(var t=new Array(e.length),n=0;n<e.length;n++)"object"==typeof e[n]&&(t[n]=new RegExp("^"+e[n].pattern+"$"));return function(n){for(var r="",o=n||{},i=0;i<e.length;i++){var s=e[i];if("string"!=typeof s){var a,c=o[s.name];if(null==c){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to be defined')}if(C(c)){if(!s.repeat)throw new TypeError('Expected "'+s.name+'" to not repeat, but received "'+c+'"');if(0===c.length){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var l=0;l<c.length;l++){if(a=encodeURIComponent(c[l]),!t[i].test(a))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'", but received "'+a+'"');r+=(0===l?s.prefix:s.delimiter)+a}}else{if(a=encodeURIComponent(c),!t[i].test(a))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but received "'+a+'"');r+=s.prefix+a}}else r+=s}return r}}function L(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function j(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function D(e,t){return e.keys=t,e}function N(e){return e.sensitive?"":"i"}function I(e,t){for(var n=(t=t||{}).strict,r=!1!==t.end,o="",i=e[e.length-1],s="string"==typeof i&&/\/$/.test(i),a=0;a<e.length;a++){var c=e[a];if("string"==typeof c)o+=L(c);else{var l=L(c.prefix),u=c.pattern;c.repeat&&(u+="(?:"+l+u+")*"),o+=u=c.optional?l?"(?:"+l+"("+u+"))?":"("+u+")?":l+"("+u+")"}}return n||(o=(s?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=r?"$":n&&s?"":"(?=\\/|$)",new RegExp("^"+o,N(t))}function $(e,t,n){return C(t=t||[])?n||(n={}):(n=t,t=[]),e instanceof RegExp?function(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)t.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return D(e,t)}(e,t):C(e)?function(e,t,n){for(var r=[],o=0;o<e.length;o++)r.push($(e[o],t,n).source);return D(new RegExp("(?:"+r.join("|")+")",N(n)),t)}(e,t,n):function(e,t,n){for(var r=M(e),o=I(r,n),i=0;i<r.length;i++)"string"!=typeof r[i]&&t.push(r[i]);return D(o,t)}(e,t,n)}S.parse=A,S.compile=O,S.tokensToFunction=T,S.tokensToRegExp=P;var U,B="undefined"!=typeof document,H="undefined"!=typeof window,F="undefined"!=typeof history,z="undefined"!=typeof process,K=B&&document.ontouchstart?"touchstart":"click",W=H&&!(!window.history.location&&!window.location);function V(){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this)}function G(e,t){if("function"==typeof e)return G.call(this,"*",e);if("function"==typeof t)for(var n=new J(e,null,this),r=1;r<arguments.length;++r)this.callbacks.push(n.middleware(arguments[r]));else"string"==typeof e?this["string"==typeof t?"redirect":"show"](e,t):this.start(e)}function Q(e){if(!e.handled){var t=this,n=t._window;(t._hashbang?W&&this._getBase()+n.location.hash.replace("#!",""):W&&n.location.pathname+n.location.search)!==e.canonicalPath&&(t.stop(),e.handled=!1,W&&(n.location.href=e.canonicalPath))}}function Y(e,t,n){var r=this.page=n||G,o=r._window,i=r._hashbang,s=r._getBase();"/"===e[0]&&0!==e.indexOf(s)&&(e=s+(i?"#!":"")+e);var a=e.indexOf("?");this.canonicalPath=e;var c=new RegExp("^"+s.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"));if(this.path=e.replace(c,"")||"/",i&&(this.path=this.path.replace("#!","")||"/"),this.title=B&&o.document.title,this.state=t||{},this.state.path=e,this.querystring=~a?r._decodeURLEncodedURIComponent(e.slice(a+1)):"",this.pathname=r._decodeURLEncodedURIComponent(~a?e.slice(0,a):e),this.params={},this.hash="",!i){if(!~this.path.indexOf("#"))return;var l=this.path.split("#");this.path=this.pathname=l[0],this.hash=r._decodeURLEncodedURIComponent(l[1])||"",this.querystring=this.querystring.split("#")[0]}}function J(e,t,n){var r=this.page=n||X,o=t||{};o.strict=o.strict||r._strict,this.path="*"===e?"(.*)":e,this.method="GET",this.regexp=S(this.path,this.keys=[],o)}V.prototype.configure=function(e){var t=e||{};this._window=t.window||H&&window,this._decodeURLComponents=!1!==t.decodeURLComponents,this._popstate=!1!==t.popstate&&H,this._click=!1!==t.click&&B,this._hashbang=!!t.hashbang;var n=this._window;this._popstate?n.addEventListener("popstate",this._onpopstate,!1):H&&n.removeEventListener("popstate",this._onpopstate,!1),this._click?n.document.addEventListener(K,this.clickHandler,!1):B&&n.document.removeEventListener(K,this.clickHandler,!1),this._hashbang&&H&&!F?n.addEventListener("hashchange",this._onpopstate,!1):H&&n.removeEventListener("hashchange",this._onpopstate,!1)},V.prototype.base=function(e){if(0===arguments.length)return this._base;this._base=e},V.prototype._getBase=function(){var e=this._base;if(e)return e;var t=H&&this._window&&this._window.location;return H&&this._hashbang&&t&&"file:"===t.protocol&&(e=t.pathname),e},V.prototype.strict=function(e){if(0===arguments.length)return this._strict;this._strict=e},V.prototype.start=function(e){var t=e||{};if(this.configure(t),!1!==t.dispatch){var n;if(this._running=!0,W){var r=this._window.location;n=this._hashbang&&~r.hash.indexOf("#!")?r.hash.substr(2)+r.search:this._hashbang?r.search+r.hash:r.pathname+r.search+r.hash}this.replace(n,null,!0,t.dispatch)}},V.prototype.stop=function(){if(this._running){this.current="",this.len=0,this._running=!1;var e=this._window;this._click&&e.document.removeEventListener(K,this.clickHandler,!1),H&&e.removeEventListener("popstate",this._onpopstate,!1),H&&e.removeEventListener("hashchange",this._onpopstate,!1)}},V.prototype.show=function(e,t,n,r){var o=new Y(e,t,this),i=this.prevContext;return this.prevContext=o,this.current=o.path,!1!==n&&this.dispatch(o,i),!1!==o.handled&&!1!==r&&o.pushState(),o},V.prototype.back=function(e,t){var n=this;if(this.len>0){var r=this._window;F&&r.history.back(),this.len--}else e?setTimeout((function(){n.show(e,t)})):setTimeout((function(){n.show(n._getBase(),t)}))},V.prototype.redirect=function(e,t){var n=this;"string"==typeof e&&"string"==typeof t&&G.call(this,e,(function(e){setTimeout((function(){n.replace(t)}),0)})),"string"==typeof e&&void 0===t&&setTimeout((function(){n.replace(e)}),0)},V.prototype.replace=function(e,t,n,r){var o=new Y(e,t,this),i=this.prevContext;return this.prevContext=o,this.current=o.path,o.init=n,o.save(),!1!==r&&this.dispatch(o,i),o},V.prototype.dispatch=function(e,t){var n=0,r=0,o=this;function i(){var t=o.callbacks[n++];if(e.path===o.current)return t?void t(e,i):Q.call(o,e);e.handled=!1}t?function e(){var n=o.exits[r++];if(!n)return i();n(t,e)}():i()},V.prototype.exit=function(e,t){if("function"==typeof e)return this.exit("*",e);for(var n=new J(e,null,this),r=1;r<arguments.length;++r)this.exits.push(n.middleware(arguments[r]))},V.prototype.clickHandler=function(e){if(1===this._which(e)&&!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){var t=e.target,n=e.path||(e.composedPath?e.composedPath():null);if(n)for(var r=0;r<n.length;r++)if(n[r].nodeName&&"A"===n[r].nodeName.toUpperCase()&&n[r].href){t=n[r];break}for(;t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;if(t&&"A"===t.nodeName.toUpperCase()){var o="object"==typeof t.href&&"SVGAnimatedString"===t.href.constructor.name;if(!t.hasAttribute("download")&&"external"!==t.getAttribute("rel")){var i=t.getAttribute("href");if((this._hashbang||!this._samePath(t)||!t.hash&&"#"!==i)&&!(i&&i.indexOf("mailto:")>-1)&&!(o?t.target.baseVal:t.target)&&(o||this.sameOrigin(t.href))){var s=o?t.href.baseVal:t.pathname+t.search+(t.hash||"");s="/"!==s[0]?"/"+s:s,z&&s.match(/^\/[a-zA-Z]:\//)&&(s=s.replace(/^\/[a-zA-Z]:\//,"/"));var a=s,c=this._getBase();0===s.indexOf(c)&&(s=s.substr(c.length)),this._hashbang&&(s=s.replace("#!","")),(!c||a!==s||W&&"file:"===this._window.location.protocol)&&(e.preventDefault(),this.show(a))}}}}},V.prototype._onpopstate=(U=!1,H?(B&&"complete"===document.readyState?U=!0:window.addEventListener("load",(function(){setTimeout((function(){U=!0}),0)})),function(e){if(U){var t=this;if(e.state){var n=e.state.path;t.replace(n,e.state)}else if(W){var r=t._window.location;t.show(r.pathname+r.search+r.hash,void 0,void 0,!1)}}}):function(){}),V.prototype._which=function(e){return null==(e=e||H&&this._window.event).which?e.button:e.which},V.prototype._toURL=function(e){var t=this._window;if("function"==typeof URL&&W)return new URL(e,t.location.toString());if(B){var n=t.document.createElement("a");return n.href=e,n}},V.prototype.sameOrigin=function(e){if(!e||!W)return!1;var t=this._toURL(e),n=this._window.location;return n.protocol===t.protocol&&n.hostname===t.hostname&&(n.port===t.port||""===n.port&&(80==t.port||443==t.port))},V.prototype._samePath=function(e){if(!W)return!1;var t=this._window.location;return e.pathname===t.pathname&&e.search===t.search},V.prototype._decodeURLEncodedURIComponent=function(e){return"string"!=typeof e?e:this._decodeURLComponents?decodeURIComponent(e.replace(/\+/g," ")):e},Y.prototype.pushState=function(){var e=this.page,t=e._window,n=e._hashbang;e.len++,F&&t.history.pushState(this.state,this.title,n&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},Y.prototype.save=function(){var e=this.page;F&&e._window.history.replaceState(this.state,this.title,e._hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},J.prototype.middleware=function(e){var t=this;return function(n,r){if(t.match(n.path,n.params))return n.routePath=t.path,e(n,r);r()}},J.prototype.match=function(e,t){var n=this.keys,r=e.indexOf("?"),o=~r?e.slice(0,r):e,i=this.regexp.exec(decodeURIComponent(o));if(!i)return!1;delete t[0];for(var s=1,a=i.length;s<a;++s){var c=n[s-1],l=this.page._decodeURLEncodedURIComponent(i[s]);void 0===l&&hasOwnProperty.call(t,c.name)||(t[c.name]=l)}return!0};var X=function e(){var t=new V;function n(){return G.apply(t,arguments)}return n.callbacks=t.callbacks,n.exits=t.exits,n.base=t.base.bind(t),n.strict=t.strict.bind(t),n.start=t.start.bind(t),n.stop=t.stop.bind(t),n.show=t.show.bind(t),n.back=t.back.bind(t),n.redirect=t.redirect.bind(t),n.replace=t.replace.bind(t),n.dispatch=t.dispatch.bind(t),n.exit=t.exit.bind(t),n.configure=t.configure.bind(t),n.sameOrigin=t.sameOrigin.bind(t),n.clickHandler=t.clickHandler.bind(t),n.create=e,Object.defineProperty(n,"len",{get:function(){return t.len},set:function(e){t.len=e}}),Object.defineProperty(n,"current",{get:function(){return t.current},set:function(e){t.current=e}}),n.Context=Y,n.Route=J,n}(),Z=X,ee=X;Z.default=ee;const te=location.pathname.replace(/\/$/,""),ne=e=>`${te}${e}`,re=e=>({href:ne(e)}),oe="https://lichess.org",ie=["board:play"],se=`${location.protocol}//${location.host}${te||"/"}`;class ae{constructor(){this.oauth=new x.OAuth2AuthCodePKCE({authorizationUrl:`${oe}/oauth`,tokenUrl:`${oe}/api/token`,clientId:"lichess-api-demo",scopes:ie,redirectUrl:se,onAccessTokenExpiry:e=>e(),onInvalidGrant:console.warn}),this.authenticate=async()=>{const e=this.oauth.decorateFetchHTTPClient(window.fetch),t=await e(`${oe}/api/account`),n=Object.assign(Object.assign({},await t.json()),{httpClient:e});if(n.error)throw n.error;this.me=n},this.openStream=async(e,t,n)=>((e,t,n)=>{const r=t.body.getReader(),o=/\r?\n/,i=new TextDecoder;let s="";const a=t=>{const r=JSON.parse(t);console.log(e,r),n(r)},c=()=>r.read().then((({done:e,value:t})=>{if(!e){const e=i.decode(t,{stream:!0});s+=e;const n=s.split(o);s=n.pop()||"";for(const e of n.filter((e=>e)))a(e);return c()}s.length>0&&a(s)}));return{closePromise:c(),close:()=>r.cancel()}})(`STREAM ${e}`,await this.fetchResponse(e,t),n),this.fetchBody=async(e,t={})=>{const n=await this.fetchResponse(e,t);return await n.json()},this.fetchResponse=async(e,t={})=>{var n;const r=await((null===(n=this.me)||void 0===n?void 0:n.httpClient)||window.fetch)(`${oe}${e}`,t);if(r.error||!r.ok){const e=`${r.error} ${r.status} ${r.statusText}`;throw alert(e),e}return r}}async init(){try{await this.oauth.getAccessToken()&&await this.authenticate()}catch(e){console.error(e)}if(!this.me)try{await this.oauth.isReturningFromAuthServer()&&await this.authenticate()}catch(e){console.error(e)}}async login(){await this.oauth.fetchAuthorizationCode()}async logout(){this.me&&await this.me.httpClient(`${oe}/api/token`,{method:"DELETE"}),localStorage.clear(),this.me=void 0}}const ce=["a","b","c","d","e","f","g","h"],le=["1","2","3","4","5","6","7","8"],ue=["white","black"],he=["pawn","knight","bishop","rook","queen","king"],de=["a","h"];function pe(e){return"role"in e}function fe(e){return void 0!==e}function me(e){return"white"===e?"black":"white"}function ge(e){return e>>3}function ve(e){return 7&e}function be(e){switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}}function we(e){switch(e){case"P":case"p":return"pawn";case"N":case"n":return"knight";case"B":case"b":return"bishop";case"R":case"r":return"rook";case"Q":case"q":return"queen";case"K":case"k":return"king";default:return}}function ye(e){if(2!==e.length)return;const t=e.charCodeAt(0)-"a".charCodeAt(0),n=e.charCodeAt(1)-"1".charCodeAt(0);return t<0||t>=8||n<0||n>=8?void 0:t+8*n}function ke(e){return ce[ve(e)]+le[ge(e)]}function Ee(e,t){return"white"===e?"a"===t?2:6:"a"===t?58:62}function _e(e){return e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24}function xe(e){return(e=e>>>8&16711935|(16711935&e)<<8)>>>16&65535|(65535&e)<<16}function Ce(e){return xe(e=(e=(e=e>>>1&1431655765|(1431655765&e)<<1)>>>2&858993459|(858993459&e)<<2)>>>4&252645135|(252645135&e)<<4)}class Se{constructor(e,t){this.lo=e,this.hi=t,this.lo=0|e,this.hi=0|t}static fromSquare(e){return e>=32?new Se(0,1<<e-32):new Se(1<<e,0)}static fromRank(e){return new Se(255,0).shl64(8*e)}static fromFile(e){return new Se(16843009<<e,16843009<<e)}static empty(){return new Se(0,0)}static full(){return new Se(4294967295,4294967295)}static corners(){return new Se(129,2164260864)}static center(){return new Se(402653184,24)}static backranks(){return new Se(255,4278190080)}static backrank(e){return"white"===e?new Se(255,0):new Se(0,4278190080)}static lightSquares(){return new Se(1437226410,1437226410)}static darkSquares(){return new Se(2857740885,2857740885)}complement(){return new Se(~this.lo,~this.hi)}xor(e){return new Se(this.lo^e.lo,this.hi^e.hi)}union(e){return new Se(this.lo|e.lo,this.hi|e.hi)}intersect(e){return new Se(this.lo&e.lo,this.hi&e.hi)}diff(e){return new Se(this.lo&~e.lo,this.hi&~e.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(e){return e>=64?Se.empty():e>=32?new Se(this.hi>>>e-32,0):e>0?new Se(this.lo>>>e^this.hi<<32-e,this.hi>>>e):this}shl64(e){return e>=64?Se.empty():e>=32?new Se(0,this.lo<<e-32):e>0?new Se(this.lo<<e,this.hi<<e^this.lo>>>32-e):this}bswap64(){return new Se(xe(this.hi),xe(this.lo))}rbit64(){return new Se(Ce(this.hi),Ce(this.lo))}minus64(e){const t=this.lo-e.lo,n=(t&e.lo&1)+(e.lo>>>1)+(t>>>1)>>>31;return new Se(t,this.hi-(e.hi+n))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return _e(this.lo)+_e(this.hi)}isEmpty(){return 0===this.lo&&0===this.hi}nonEmpty(){return 0!==this.lo||0!==this.hi}has(e){return 0!=(e>=32?this.hi&1<<e-32:this.lo&1<<e)}set(e,t){return t?this.with(e):this.without(e)}with(e){return e>=32?new Se(this.lo,this.hi|1<<e-32):new Se(this.lo|1<<e,this.hi)}without(e){return e>=32?new Se(this.lo,this.hi&~(1<<e-32)):new Se(this.lo&~(1<<e),this.hi)}toggle(e){return e>=32?new Se(this.lo,this.hi^1<<e-32):new Se(this.lo^1<<e,this.hi)}last(){return 0!==this.hi?63-Math.clz32(this.hi):0!==this.lo?31-Math.clz32(this.lo):void 0}first(){return 0!==this.lo?31-Math.clz32(this.lo&-this.lo):0!==this.hi?63-Math.clz32(this.hi&-this.hi):void 0}withoutFirst(){return 0!==this.lo?new Se(this.lo&this.lo-1,this.hi):new Se(0,this.hi&this.hi-1)}moreThanOne(){return 0!==this.hi&&0!==this.lo||0!=(this.lo&this.lo-1)||0!=(this.hi&this.hi-1)}singleSquare(){return this.moreThanOne()?void 0:this.last()}isSingleSquare(){return this.nonEmpty()&&!this.moreThanOne()}*[Symbol.iterator](){let e=this.lo,t=this.hi;for(;0!==e;){const t=31-Math.clz32(e&-e);e^=1<<t,yield t}for(;0!==t;){const e=31-Math.clz32(t&-t);t^=1<<e,yield 32+e}}*reversed(){let e=this.lo,t=this.hi;for(;0!==t;){const e=31-Math.clz32(t);t^=1<<e,yield 32+e}for(;0!==e;){const t=31-Math.clz32(e);e^=1<<t,yield t}}}function Ae(e,t){let n=Se.empty();for(const r of t){const t=e+r;0<=t&&t<64&&Math.abs(ve(e)-ve(t))<=2&&(n=n.with(t))}return n}function Oe(e){const t=[];for(let n=0;n<64;n++)t[n]=e(n);return t}const Te=Oe((e=>Ae(e,[-9,-8,-7,-1,1,7,8,9]))),Pe=Oe((e=>Ae(e,[-17,-15,-10,-6,6,10,15,17]))),Re={white:Oe((e=>Ae(e,[7,9]))),black:Oe((e=>Ae(e,[-7,-9])))};function Me(e){return Te[e]}function qe(e){return Pe[e]}function Le(e,t){return Re[e][t]}const je=Oe((e=>Se.fromFile(ve(e)).without(e))),De=Oe((e=>Se.fromRank(ge(e)).without(e))),Ne=Oe((e=>{const t=new Se(134480385,2151686160),n=8*(ge(e)-ve(e));return(n>=0?t.shl64(n):t.shr64(-n)).without(e)})),Ie=Oe((e=>{const t=new Se(270549120,16909320),n=8*(ge(e)+ve(e)-7);return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}));function $e(e,t,n){let r=n.intersect(t),o=r.bswap64();return r=r.minus64(e),o=o.minus64(e.bswap64()),r.xor(o.bswap64()).intersect(t)}function Ue(e,t){const n=Se.fromSquare(e);return $e(n,Ne[e],t).xor($e(n,Ie[e],t))}function Be(e,t){return function(e,t){return $e(Se.fromSquare(e),je[e],t)}(e,t).xor(function(e,t){const n=De[e];let r=t.intersect(n),o=r.rbit64();return r=r.minus64(Se.fromSquare(e)),o=o.minus64(Se.fromSquare(63-e)),r.xor(o.rbit64()).intersect(n)}(e,t))}function He(e,t){return Ue(e,t).xor(Be(e,t))}function Fe(e,t){const n=Se.fromSquare(t);return De[e].intersects(n)?De[e].with(e):Ie[e].intersects(n)?Ie[e].with(e):Ne[e].intersects(n)?Ne[e].with(e):je[e].intersects(n)?je[e].with(e):Se.empty()}function ze(e,t){return Fe(e,t).intersect(Se.full().shl64(e).xor(Se.full().shl64(t))).withoutFirst()}class Ke{constructor(){}static default(){const e=new Ke;return e.reset(),e}static racingKings(){const e=new Ke;return e.occupied=new Se(65535,0),e.promoted=Se.empty(),e.white=new Se(61680,0),e.black=new Se(3855,0),e.pawn=Se.empty(),e.knight=new Se(6168,0),e.bishop=new Se(9252,0),e.rook=new Se(16962,0),e.queen=new Se(129,0),e.king=new Se(33024,0),e}static horde(){const e=new Ke;return e.occupied=new Se(4294967295,4294901862),e.promoted=Se.empty(),e.white=new Se(4294967295,102),e.black=new Se(0,4294901760),e.pawn=new Se(4294967295,16711782),e.knight=new Se(0,1107296256),e.bishop=new Se(0,603979776),e.rook=new Se(0,2164260864),e.queen=new Se(0,134217728),e.king=new Se(0,268435456),e}reset(){this.occupied=new Se(65535,4294901760),this.promoted=Se.empty(),this.white=new Se(65535,0),this.black=new Se(0,4294901760),this.pawn=new Se(65280,16711680),this.knight=new Se(66,1107296256),this.bishop=new Se(36,603979776),this.rook=new Se(129,2164260864),this.queen=new Se(8,134217728),this.king=new Se(16,268435456)}static empty(){const e=new Ke;return e.clear(),e}clear(){this.occupied=Se.empty(),this.promoted=Se.empty();for(const e of ue)this[e]=Se.empty();for(const e of he)this[e]=Se.empty()}clone(){const e=new Ke;e.occupied=this.occupied,e.promoted=this.promoted;for(const t of ue)e[t]=this[t];for(const t of he)e[t]=this[t];return e}equalsIgnorePromoted(e){return!!this.white.equals(e.white)&&he.every((t=>this[t].equals(e[t])))}equals(e){return this.equalsIgnorePromoted(e)&&this.promoted.equals(e.promoted)}getColor(e){return this.white.has(e)?"white":this.black.has(e)?"black":void 0}getRole(e){for(const t of he)if(this[t].has(e))return t}get(e){const t=this.getColor(e);if(!t)return;return{color:t,role:this.getRole(e),promoted:this.promoted.has(e)}}take(e){const t=this.get(e);return t&&(this.occupied=this.occupied.without(e),this[t.color]=this[t.color].without(e),this[t.role]=this[t.role].without(e),t.promoted&&(this.promoted=this.promoted.without(e))),t}set(e,t){const n=this.take(e);return this.occupied=this.occupied.with(e),this[t.color]=this[t.color].with(e),this[t.role]=this[t.role].with(e),t.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(const e of this.occupied)yield[e,this.get(e)]}pieces(e,t){return this[e].intersect(this[t])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.king.intersect(this[e]).diff(this.promoted).singleSquare()}}class We{constructor(){}static empty(){const e=new We;for(const t of he)e[t]=0;return e}static fromBoard(e,t){const n=new We;for(const r of he)n[r]=e.pieces(t,r).size();return n}clone(){const e=new We;for(const t of he)e[t]=this[t];return e}equals(e){return he.every((t=>this[t]===e[t]))}add(e){const t=new We;for(const n of he)t[n]=this[n]+e[n];return t}nonEmpty(){return he.some((e=>this[e]>0))}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}count(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class Ve{constructor(e,t){this.white=e,this.black=t}static empty(){return new Ve(We.empty(),We.empty())}static fromBoard(e){return new Ve(We.fromBoard(e,"white"),We.fromBoard(e,"black"))}clone(){return new Ve(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(e){return new Ve(this.white.add(e.white),this.black.add(e.black))}count(){return this.white.count()+this.black.count()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class Ge{constructor(e,t){this.white=e,this.black=t}static default(){return new Ge(3,3)}clone(){return new Ge(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}}function Qe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Ye,Je,Xe,Ze=function(){function e(){}var t=e.prototype;return t.unwrap=function(e,t){var n=this._chain((function(t){return Ye.ok(e?e(t):t)}),(function(e){return t?Ye.ok(t(e)):Ye.err(e)}));if(n.isErr)throw n.error;return n.value},t.map=function(e,t){return this._chain((function(t){return Ye.ok(e(t))}),(function(e){return Ye.err(t?t(e):e)}))},t.chain=function(e,t){return this._chain(e,t||function(e){return Ye.err(e)})},e}(),et=function(e){function t(t){var n;return(n=e.call(this)||this).value=t,n.isOk=!0,n.isErr=!1,n}return Qe(t,e),t.prototype._chain=function(e,t){return e(this.value)},t}(Ze),tt=function(e){function t(t){var n;return(n=e.call(this)||this).error=t,n.isOk=!1,n.isErr=!0,n}return Qe(t,e),t.prototype._chain=function(e,t){return t(this.error)},t}(Ze);!function(e){e.ok=function(e){return new et(e)},e.err=function(e){return new tt(e||new Error)},e.all=function(t){if(Array.isArray(t)){for(var n=[],r=0;r<t.length;r++){var o=t[r];if(o.isErr)return o;n.push(o.value)}return e.ok(n)}for(var i={},s=Object.keys(t),a=0;a<s.length;a++){var c=t[s[a]];if(c.isErr)return c;i[s[a]]=c.value}return e.ok(i)}}(Ye||(Ye={})),function(e){e.Empty="ERR_EMPTY",e.OppositeCheck="ERR_OPPOSITE_CHECK",e.ImpossibleCheck="ERR_IMPOSSIBLE_CHECK",e.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",e.Kings="ERR_KINGS",e.Variant="ERR_VARIANT"}(Je||(Je={}));class nt extends Error{}function rt(e,t){return"white"===e?"a"===t?3:5:"a"===t?59:61}class ot{constructor(){}static default(){const e=new ot;return e.unmovedRooks=Se.corners(),e.rook={white:{a:0,h:7},black:{a:56,h:63}},e.path={white:{a:new Se(14,0),h:new Se(96,0)},black:{a:new Se(0,234881024),h:new Se(0,1610612736)}},e}static empty(){const e=new ot;return e.unmovedRooks=Se.empty(),e.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},e.path={white:{a:Se.empty(),h:Se.empty()},black:{a:Se.empty(),h:Se.empty()}},e}clone(){const e=new ot;return e.unmovedRooks=this.unmovedRooks,e.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},e.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},e}add(e,t,n,r){const o=Ee(e,t),i=rt(e,t);this.unmovedRooks=this.unmovedRooks.with(r),this.rook[e][t]=r,this.path[e][t]=ze(r,i).with(i).union(ze(n,o).with(o)).without(n).without(r)}static fromSetup(e){const t=ot.empty(),n=e.unmovedRooks.intersect(e.board.rook);for(const r of ue){const o=Se.backrank(r),i=e.board.kingOf(r);if(!fe(i)||!o.has(i))continue;const s=n.intersect(e.board[r]).intersect(o),a=s.first();fe(a)&&a<i&&t.add(r,"a",i,a);const c=s.last();fe(c)&&i<c&&t.add(r,"h",i,c)}return t}discardRook(e){if(this.unmovedRooks.has(e)){this.unmovedRooks=this.unmovedRooks.without(e);for(const t of ue)for(const n of de)this.rook[t][n]===e&&(this.rook[t][n]=void 0)}}discardSide(e){this.unmovedRooks=this.unmovedRooks.diff(Se.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}class it extends class{constructor(e){this.rules=e}kingAttackers(e,t,n){return function(e,t,n,r){return n[t].intersect(Be(e,r).intersect(n.rooksAndQueens()).union(Ue(e,r).intersect(n.bishopsAndQueens())).union(qe(e).intersect(n.knight)).union(Me(e).intersect(n.king)).union(Le(me(t),e).intersect(n.pawn)))}(e,t,this.board,n)}dropDests(e){return Se.empty()}playCaptureAt(e,t){this.halfmoves=0,"rook"===t.role&&this.castles.discardRook(e),this.pockets&&this.pockets[me(t.color)][t.role]++}ctx(){const e=this.isVariantEnd(),t=this.board.kingOf(this.turn);if(!fe(t))return{king:t,blockers:Se.empty(),checkers:Se.empty(),variantEnd:e,mustCapture:!1};const n=Be(t,Se.empty()).intersect(this.board.rooksAndQueens()).union(Ue(t,Se.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[me(this.turn)]);let r=Se.empty();for(const e of n){const n=ze(t,e).intersect(this.board.occupied);n.moreThanOne()||(r=r.union(n))}return{king:t,blockers:r,checkers:this.kingAttackers(t,me(this.turn),this.board.occupied),variantEnd:e,mustCapture:!1}}clone(){var e,t;const n=new this.constructor;return n.board=this.board.clone(),n.pockets=null===(e=this.pockets)||void 0===e?void 0:e.clone(),n.turn=this.turn,n.castles=this.castles.clone(),n.epSquare=this.epSquare,n.remainingChecks=null===(t=this.remainingChecks)||void 0===t?void 0:t.clone(),n.halfmoves=this.halfmoves,n.fullmoves=this.fullmoves,n}equalsIgnoreMoves(e){var t,n;return this.rules===e.rules&&(this.pockets?this.board.equals(e.board):this.board.equalsIgnorePromoted(e.board))&&(e.pockets&&(null===(t=this.pockets)||void 0===t?void 0:t.equals(e.pockets))||!this.pockets&&!e.pockets)&&this.turn===e.turn&&this.castles.unmovedRooks.equals(e.castles.unmovedRooks)&&this.legalEpSquare()===e.legalEpSquare()&&(e.remainingChecks&&(null===(n=this.remainingChecks)||void 0===n?void 0:n.equals(e.remainingChecks))||!this.remainingChecks&&!e.remainingChecks)}toSetup(){var e,t;return{board:this.board.clone(),pockets:null===(e=this.pockets)||void 0===e?void 0:e.clone(),turn:this.turn,unmovedRooks:this.castles.unmovedRooks,epSquare:this.legalEpSquare(),remainingChecks:null===(t=this.remainingChecks)||void 0===t?void 0:t.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return ue.every((e=>this.hasInsufficientMaterial(e)))}hasDests(e){e=e||this.ctx();for(const t of this.board[this.turn])if(this.dests(t,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,t){if(pe(e))return!(!this.pockets||this.pockets[this.turn][e.role]<=0)&&(("pawn"!==e.role||!Se.backranks().has(e.to))&&this.dropDests(t).has(e.to));{if("pawn"===e.promotion)return!1;if("king"===e.promotion&&"antichess"!==this.rules)return!1;if(!!e.promotion!==(this.board.pawn.has(e.from)&&Se.backranks().has(e.to)))return!1;const n=this.dests(e.from,t);return n.has(e.to)||n.has(this.normalizeMove(e).to)}}isCheck(){const e=this.board.kingOf(this.turn);return fe(e)&&this.kingAttackers(e,me(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return!!(e?e.variantEnd:this.isVariantEnd())||(this.isInsufficientMaterial()||!this.hasDests(e))}isCheckmate(e){return!(e=e||this.ctx()).variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return!(e=e||this.ctx()).variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){const t=this.variantOutcome(e);return t||(e=e||this.ctx(),this.isCheckmate(e)?{winner:me(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}allDests(e){e=e||this.ctx();const t=new Map;if(e.variantEnd)return t;for(const n of this.board[this.turn])t.set(n,this.dests(n,e));return t}castlingSide(e){if(pe(e))return;const t=e.to-e.from;return(2===Math.abs(t)||this.board[this.turn].has(e.to))&&this.board.king.has(e.from)?t>0?"h":"a":void 0}normalizeMove(e){const t=this.castlingSide(e);if(!t)return e;const n=this.castles.rook[this.turn][t];return{from:e.from,to:fe(n)?n:e.to}}play(e){const t=this.turn,n=this.epSquare,r=this.castlingSide(e);if(this.epSquare=void 0,this.halfmoves+=1,"black"===t&&(this.fullmoves+=1),this.turn=me(t),pe(e))this.board.set(e.to,{role:e.role,color:t}),this.pockets&&this.pockets[t][e.role]--,"pawn"===e.role&&(this.halfmoves=0);else{const o=this.board.take(e.from);if(!o)return;let i;if("pawn"===o.role){this.halfmoves=0,e.to===n&&(i=this.board.take(e.to+("white"===t?-8:8)));const r=e.from-e.to;16===Math.abs(r)&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(o.role=e.promotion,o.promoted=!0)}else if("rook"===o.role)this.castles.discardRook(e.from);else if("king"===o.role){if(r){const e=this.castles.rook[t][r];if(fe(e)){const n=this.board.take(e);this.board.set(Ee(t,r),o),n&&this.board.set(rt(t,r),n)}}this.castles.discardSide(t)}if(!r){const t=this.board.set(e.to,o)||i;t&&this.playCaptureAt(e.to,t)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[t]=Math.max(this.remainingChecks[t]-1,0))}legalEpSquare(e){if(!fe(this.epSquare))return;e=e||this.ctx();const t=this.board.pieces(this.turn,"pawn").intersect(Le(me(this.turn),this.epSquare));for(const n of t)if(this.dests(n,e).has(this.epSquare))return this.epSquare}}{constructor(e){super(e||"chess")}static default(){const e=new this;return e.board=Ke.default(),e.pockets=void 0,e.turn="white",e.castles=ot.default(),e.epSquare=void 0,e.remainingChecks=void 0,e.halfmoves=0,e.fullmoves=1,e}static fromSetup(e,t){const n=new this;return n.board=e.board.clone(),n.pockets=void 0,n.turn=e.turn,n.castles=ot.fromSetup(e),n.epSquare=n.validEpSquare(e.epSquare),n.remainingChecks=void 0,n.halfmoves=e.halfmoves,n.fullmoves=e.fullmoves,n.validate(t).map((e=>n))}clone(){return super.clone()}validate(e){if(this.board.occupied.isEmpty())return Ye.err(new nt(Je.Empty));if(2!==this.board.king.size())return Ye.err(new nt(Je.Kings));if(!fe(this.board.kingOf(this.turn)))return Ye.err(new nt(Je.Kings));const t=this.board.kingOf(me(this.turn));return fe(t)?this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty()?Ye.err(new nt(Je.OppositeCheck)):Se.backranks().intersects(this.board.pawn)?Ye.err(new nt(Je.PawnsOnBackrank)):(null==e?void 0:e.ignoreImpossibleCheck)?Ye.ok(void 0):this.validateCheckers():Ye.err(new nt(Je.Kings))}validateCheckers(){const e=this.board.kingOf(this.turn);if(fe(e)){const t=this.kingAttackers(e,me(this.turn),this.board.occupied);if(t.nonEmpty())if(fe(this.epSquare)){const n=8^this.epSquare,r=24^this.epSquare;if(t.moreThanOne()||t.first()!=n&&this.kingAttackers(e,me(this.turn),this.board.occupied.without(n).with(r)).nonEmpty())return Ye.err(new nt(Je.ImpossibleCheck))}else if(t.size()>2||2===t.size()&&Fe(t.first(),t.last()).has(e))return Ye.err(new nt(Je.ImpossibleCheck))}return Ye.ok(void 0)}validEpSquare(e){if(!fe(e))return;const t="white"===this.turn?5:2,n="white"===this.turn?8:-8;if(ge(e)!==t)return;if(this.board.occupied.has(e+n))return;const r=e-n;return this.board.pawn.has(r)&&this.board[me(this.turn)].has(r)?e:void 0}castlingDest(e,t){if(!fe(t.king)||t.checkers.nonEmpty())return Se.empty();const n=this.castles.rook[this.turn][e];if(!fe(n))return Se.empty();if(this.castles.path[this.turn][e].intersects(this.board.occupied))return Se.empty();const r=Ee(this.turn,e),o=ze(t.king,r),i=this.board.occupied.without(t.king);for(const e of o)if(this.kingAttackers(e,me(this.turn),i).nonEmpty())return Se.empty();const s=rt(this.turn,e),a=this.board.occupied.toggle(t.king).toggle(n).toggle(s);return this.kingAttackers(r,me(this.turn),a).nonEmpty()?Se.empty():Se.fromSquare(n)}canCaptureEp(e,t){if(!fe(this.epSquare))return!1;if(!Le(this.turn,e).has(this.epSquare))return!1;if(!fe(t.king))return!0;const n=this.epSquare+("white"===this.turn?-8:8),r=this.board.occupied.toggle(e).toggle(this.epSquare).toggle(n);return!this.kingAttackers(t.king,me(this.turn),r).intersects(r)}pseudoDests(e,t){if(t.variantEnd)return Se.empty();const n=this.board.get(e);if(!n||n.color!==this.turn)return Se.empty();let r=function(e,t,n){switch(e.role){case"pawn":return Le(e.color,t);case"knight":return qe(t);case"bishop":return Ue(t,n);case"rook":return Be(t,n);case"queen":return He(t,n);case"king":return Me(t)}}(n,e,this.board.occupied);if("pawn"===n.role){let t=this.board[me(this.turn)];fe(this.epSquare)&&(t=t.with(this.epSquare)),r=r.intersect(t);const n="white"===this.turn?8:-8,o=e+n;if(0<=o&&o<64&&!this.board.occupied.has(o)){r=r.with(o);const t=o+n;("white"===this.turn?e<16:e>=48)&&!this.board.occupied.has(t)&&(r=r.with(t))}return r}return r=r.diff(this.board[this.turn]),e===t.king?r.union(this.castlingDest("a",t)).union(this.castlingDest("h",t)):r}dests(e,t){if((t=t||this.ctx()).variantEnd)return Se.empty();const n=this.board.get(e);if(!n||n.color!==this.turn)return Se.empty();let r,o;if("pawn"===n.role){r=Le(this.turn,e).intersect(this.board[me(this.turn)]);const n="white"===this.turn?8:-8,i=e+n;if(0<=i&&i<64&&!this.board.occupied.has(i)){r=r.with(i);const t=i+n;("white"===this.turn?e<16:e>=48)&&!this.board.occupied.has(t)&&(r=r.with(t))}if(fe(this.epSquare)&&this.canCaptureEp(e,t)){const e=this.epSquare-n;(t.checkers.isEmpty()||t.checkers.singleSquare()===e)&&(o=Se.fromSquare(this.epSquare))}}else r="bishop"===n.role?Ue(e,this.board.occupied):"knight"===n.role?qe(e):"rook"===n.role?Be(e,this.board.occupied):"queen"===n.role?He(e,this.board.occupied):Me(e);if(r=r.diff(this.board[this.turn]),fe(t.king)){if("king"===n.role){const n=this.board.occupied.without(e);for(const e of r)this.kingAttackers(e,me(this.turn),n).nonEmpty()&&(r=r.without(e));return r.union(this.castlingDest("a",t)).union(this.castlingDest("h",t))}if(t.checkers.nonEmpty()){const e=t.checkers.singleSquare();if(!fe(e))return Se.empty();r=r.intersect(ze(e,t.king).with(e))}t.blockers.has(e)&&(r=r.intersect(Fe(e,t.king)))}return o&&(r=r.union(o)),r}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){if(this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty())return!1;if(this.board[e].intersects(this.board.knight))return this.board[e].size()<=2&&this.board[me(e)].diff(this.board.king).diff(this.board.queen).isEmpty();if(this.board[e].intersects(this.board.bishop)){return(!this.board.bishop.intersects(Se.darkSquares())||!this.board.bishop.intersects(Se.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty()}return!0}}function st(e,t){const n=new Map,r=e.ctx();for(const[o,i]of e.allDests(r))if(i.nonEmpty()){const e=Array.from(i,ke);(null==t?void 0:t.chess960)||o!==r.king||4!==ve(o)||(i.has(0)?e.push("c1"):i.has(56)&&e.push("c8"),i.has(7)?e.push("g1"):i.has(63)&&e.push("g8")),n.set(ke(o),e)}return n}!function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"}(Xe||(Xe={}));class at extends Error{}function ct(e){return/^\d{1,4}$/.test(e)?parseInt(e,10):void 0}function lt(e){const t=we(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}}function ut(e){const t=Ke.empty();let n=7,r=0;for(let o=0;o<e.length;o++){const i=e[o];if("/"===i&&8===r)r=0,n--;else{const s=parseInt(i,10);if(s>0)r+=s;else{if(r>=8||n<0)return Ye.err(new at(Xe.Board));const s=r+8*n,a=lt(i);if(!a)return Ye.err(new at(Xe.Board));"~"===e[o+1]&&(a.promoted=!0,o++),t.set(s,a),r++}}}return 0!==n||8!==r?Ye.err(new at(Xe.Board)):Ye.ok(t)}function ht(e){if(e.length>64)return Ye.err(new at(Xe.Pockets));const t=Ve.empty();for(const n of e){const e=lt(n);if(!e)return Ye.err(new at(Xe.Pockets));t[e.color][e.role]++}return Ye.ok(t)}function dt(e){const t=e.split("+");if(3===t.length&&""===t[0]){const e=ct(t[1]),n=ct(t[2]);return!fe(e)||e>3||!fe(n)||n>3?Ye.err(new at(Xe.RemainingChecks)):Ye.ok(new Ge(3-e,3-n))}if(2===t.length){const e=ct(t[0]),n=ct(t[1]);return!fe(e)||e>3||!fe(n)||n>3?Ye.err(new at(Xe.RemainingChecks)):Ye.ok(new Ge(e,n))}return Ye.err(new at(Xe.RemainingChecks))}function pt(e){const t=e.split(/[\s_]+/),n=t.shift();let r,o,i=Ye.ok(void 0);if(n.endsWith("]")){const e=n.indexOf("[");if(-1===e)return Ye.err(new at(Xe.Fen));r=ut(n.substr(0,e)),i=ht(n.substr(e+1,n.length-1-e-1))}else{const e=function(e,t,n){let r=e.indexOf(t);for(;n-- >0&&-1!==r;)r=e.indexOf(t,r+t.length);return r}(n,"/",7);-1===e?r=ut(n):(r=ut(n.substr(0,e)),i=ht(n.substr(e+1)))}const s=t.shift();if(fe(s)&&"w"!==s){if("b"!==s)return Ye.err(new at(Xe.Turn));o="black"}else o="white";return r.chain((e=>{const n=t.shift(),r=fe(n)?function(e,t){let n=Se.empty();if("-"===t)return Ye.ok(n);for(const r of t){const t=r.toLowerCase(),o=r===t?"black":"white",i=Se.backrank(o).intersect(e[o]);let s;if("q"===t)s=i;else if("k"===t)s=i.reversed();else{if(!("a"<=t&&t<="h"))return Ye.err(new at(Xe.Castling));s=Se.fromSquare(t.charCodeAt(0)-"a".charCodeAt(0)).intersect(i)}for(const t of s){if(e.king.has(t)&&!e.promoted.has(t))break;if(e.rook.has(t)){n=n.with(t);break}}}return ue.some((e=>Se.backrank(e).intersect(n).size()>2))?Ye.err(new at(Xe.Castling)):Ye.ok(n)}(e,n):Ye.ok(Se.empty()),s=t.shift();let a;if(fe(s)&&"-"!==s&&(a=ye(s),!fe(a)))return Ye.err(new at(Xe.EpSquare));let c,l=t.shift();fe(l)&&l.includes("+")&&(c=dt(l),l=t.shift());const u=fe(l)?ct(l):0;if(!fe(u))return Ye.err(new at(Xe.Halfmoves));const h=t.shift(),d=fe(h)?ct(h):1;if(!fe(d))return Ye.err(new at(Xe.Fullmoves));const p=t.shift();let f=Ye.ok(void 0);if(fe(p)){if(fe(c))return Ye.err(new at(Xe.RemainingChecks));f=dt(p)}else fe(c)&&(f=c);return t.length>0?Ye.err(new at(Xe.Fen)):i.chain((t=>r.chain((n=>f.map((r=>({board:e,pockets:t,turn:o,unmovedRooks:n,remainingChecks:r,epSquare:a,halfmoves:u,fullmoves:Math.max(1,d)})))))))}))}function ft(e,t){let n=be(e.role);return"white"===e.color&&(n=n.toUpperCase()),(null==t?void 0:t.promoted)&&e.promoted&&(n+="~"),n}function mt(e,t){let n="",r=0;for(let o=7;o>=0;o--)for(let i=0;i<8;i++){const s=i+8*o,a=e.get(s);a?(r>0&&(n+=r,r=0),n+=ft(a,t)):r++,7===i&&(r>0&&(n+=r,r=0),0!==o&&(n+="/"))}return n}function gt(e){return he.map((t=>be(t).repeat(e[t]))).join("")}function vt(e,t,n){const r=null==n?void 0:n.shredder;let o="";for(const n of ue){const i=Se.backrank(n),s=e.kingOf(n);if(!fe(s)||!i.has(s))continue;const a=e.pieces(n,"rook").intersect(i);for(const e of t.intersect(a).reversed())if(!r&&e===a.first()&&e<s)o+="white"===n?"Q":"q";else if(!r&&e===a.last()&&s<e)o+="white"===n?"K":"k";else{const t=ce[ve(e)];o+="white"===n?t.toUpperCase():t}}return o||"-"}class bt{constructor(e,t,n){var r;this.stream=t,this.root=n,this.chess=it.default(),this.lastUpdateAt=Date.now(),this.onUnmount=()=>{this.stream.close(),clearInterval(this.redrawInterval)},this.onUpdate=()=>{var e,t;const n="startpos"==this.game.initialFen?{board:Ke.default(),pockets:void 0,turn:"white",unmovedRooks:Se.corners(),epSquare:void 0,remainingChecks:void 0,halfmoves:0,fullmoves:1}:pt(this.game.initialFen).unwrap();this.chess=it.fromSetup(n).unwrap();const r=this.game.state.moves.split(" ").filter((e=>e));r.forEach((e=>this.chess.play(function(e){if("@"===e[1]&&4===e.length){const t=we(e[0]),n=ye(e.slice(2));if(t&&fe(n))return{role:t,to:n}}else if(4===e.length||5===e.length){const t=ye(e.slice(0,2)),n=ye(e.slice(2,4));let r;if(5===e.length&&(r=we(e[4]),!r))return;if(fe(t)&&fe(n))return{from:t,to:n,promotion:r}}}(e))));const o=r[r.length-1];this.lastMove=o&&[o.substr(0,2),o.substr(2,2)],this.lastUpdateAt=Date.now(),null===(e=this.ground)||void 0===e||e.set(this.chessgroundConfig()),this.chess.turn==this.pov&&(null===(t=this.ground)||void 0===t||t.playPremove())},this.timeOf=e=>this.game.state[`${e[0]}time`],this.userMove=async(e,t)=>{var n;null===(n=this.ground)||void 0===n||n.set({turnColor:me(this.pov)}),await this.root.auth.fetchBody(`/api/board/game/${this.game.id}/move/${e}${t}`,{method:"post"})},this.resign=async()=>{await this.root.auth.fetchBody(`/api/board/game/${this.game.id}/resign`,{method:"post"})},this.playing=()=>"started"==this.game.state.status,this.chessgroundConfig=()=>{return{orientation:this.pov,fen:(e=this.chess.toSetup(),[mt(e.board,t)+(e.pockets?`[${r=e.pockets,gt(r.white).toUpperCase()+gt(r.black)}]`:""),e.turn[0],vt(e.board,e.unmovedRooks,t),fe(e.epSquare)?ke(e.epSquare):"-",...e.remainingChecks?[(n=e.remainingChecks,`${n.white}+${n.black}`)]:[],...(null==t?void 0:t.epd)?[]:[Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))]].join(" ")),lastMove:this.lastMove,turnColor:this.chess.turn,check:!!this.chess.isCheck(),movable:{free:!1,color:this.playing()?this.pov:void 0,dests:st(this.chess)},events:{move:this.userMove},selectable:{enabled:!1}};var e,t,n,r},this.setGround=e=>this.ground=e,this.handle=e=>{switch(e.type){case"gameFull":this.game=e,this.onUpdate(),this.root.redraw();break;case"gameState":this.game.state=e,this.onUpdate(),this.root.redraw();break;default:console.error(`Unknown message type: ${e.type}`,e)}},this.game=e,this.pov=this.game.black.id==(null===(r=this.root.auth.me)||void 0===r?void 0:r.id)?"black":"white",this.onUpdate(),this.redrawInterval=setInterval(n.redraw,100)}}bt.open=(e,t)=>new Promise((async n=>{let r,o;o=await e.auth.openStream(`/api/board/game/stream/${t}`,{},(t=>{r?r.handle(t):(r=new bt(t,o,e),n(r))}))}));class wt{constructor(){this.games=[],this.autoStart=new Set,this.onStart=e=>{this.remove(e),e.compat.board?(this.games.push(e),this.autoStart.has(e.id)||e.hasMoved||Z(`/game/${e.gameId}`),this.autoStart.add(e.id)):console.log(`Skipping game ${e.gameId}, not board compatible`)},this.onFinish=e=>this.remove(e),this.empty=()=>{this.games=[]},this.remove=e=>{this.games=this.games.filter((t=>t.gameId!=e.id))}}}const yt=e=>{const t=new FormData;for(const n of Object.keys(e))t.append(n,e[n]);return t};class kt{constructor(e,t){this.stream=e,this.root=t,this.awaitClose=async()=>{await this.stream.closePromise,"seek"==this.root.page&&Z("/")},this.onUnmount=()=>this.stream.close(),this.awaitClose()}}kt.make=async(e,t)=>{const n=await t.auth.openStream("/api/board/seek",{method:"post",body:yt(e)},(e=>{}));return new kt(n,t)};class Et{constructor(e){this.redraw=e,this.auth=new ae,this.page="home",this.games=new wt,this.openHome=async()=>{var e;this.page="home",this.auth.me&&(await(null===(e=this.stream)||void 0===e?void 0:e.close()),this.games.empty(),this.stream=await this.auth.openStream("/api/stream/event",{},(e=>{switch(e.type){case"gameStart":this.games.onStart(e.game);break;case"gameFinish":this.games.onFinish(e.game);break;default:console.warn(`Unprocessed message of type ${e.type}`,e)}this.redraw()}))),this.redraw()},this.openGame=async e=>{this.page="game",this.game=void 0,this.redraw(),this.game=await bt.open(this,e),this.redraw()},this.playPool=async(e,t)=>{this.seek=await kt.make({rated:!0,time:e,increment:t},this),this.page="seek",this.redraw()}}}const _t=["white","black"],xt=["a","b","c","d","e","f","g","h"],Ct=["1","2","3","4","5","6","7","8"],St=[...Ct].reverse(),At=Array.prototype.concat(...xt.map((e=>Ct.map((t=>e+t))))),Ot=e=>At[8*e[0]+e[1]],Tt=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Pt=At.map(Tt);const Rt=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Mt=e=>"white"===e?"black":"white",qt=(e,t)=>{const n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},Lt=(e,t)=>e.role===t.role&&e.color===t.color,jt=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],Dt=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},Nt=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},It=(e,t)=>{e.style.visibility=t?"visible":"hidden"},$t=e=>{var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(t=e.targetTouches)||void 0===t?void 0:t[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},Ut=e=>2===e.buttons||2===e.button,Bt=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function Ht(e,t,n){const r=Tt(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[n.left+n.width*r[0]/8+n.width/16,n.top+n.height*(7-r[1])/8+n.height/16]}const Ft=e=>{const t=new Date(e);return p("span.clock--realtime.font-monospace",[Kt(t.getUTCMinutes())+":"+Kt(t.getUTCSeconds())])},zt=e=>{const t=new Date(e),n=Wt(t.getUTCMinutes(),2),r=Wt(t.getSeconds(),2);let o,i="";if(e>=864e5){const e=t.getUTCDate()-1;o=t.getUTCHours(),i+=(1===e?"One day":`${e} days`)+" ",0!==o&&(i+=`${o} hours`)}else e>=36e5?(o=t.getUTCHours(),i+=Vt(Wt(o,2))+":"+Vt(n)):i+=Vt(n)+":"+Vt(r);return p("span.clock--correspondence",i)},Kt=e=>(e<10?"0":"")+e,Wt=(e,t)=>(e/Math.pow(10,t)).toFixed(t).slice(2),Vt=e=>`<b>${e}</b>`;function Gt(e,t){return Math.abs(e-t)}const Qt=(e,t,n,r)=>{const o=Gt(e,n),i=Gt(t,r);return 1===o&&2===i||2===o&&1===i},Yt=(e,t,n,r)=>Gt(e,n)===Gt(t,r),Jt=(e,t,n,r)=>e===n||t===r,Xt=(e,t,n,r)=>Yt(e,t,n,r)||Jt(e,t,n,r);function Zt(e,t,n){const r=e.get(t);if(!r)return[];const o=Tt(t),i=r.role,s="pawn"===i?(a=r.color,(e,t,n,r)=>Gt(e,n)<2&&("white"===a?r===t+1||t<=1&&r===t+2&&e===n:r===t-1||t>=6&&r===t-2&&e===n)):"knight"===i?Qt:"bishop"===i?Yt:"rook"===i?Jt:"queen"===i?Xt:function(e,t,n){return(r,o,i,s)=>Gt(r,i)<2&&Gt(o,s)<2||n&&o===s&&o===("white"===e?0:7)&&(4===r&&(2===i&&t.includes(0)||6===i&&t.includes(7))||t.includes(i))}(r.color,function(e,t){const n="white"===t?"1":"8",r=[];for(const[o,i]of e)o[1]===n&&i.color===t&&"rook"===i.role&&r.push(Tt(o)[0]);return r}(e,r.color),n);var a;return Pt.filter((e=>(o[0]!==e[0]||o[1]!==e[1])&&s(o[0],o[1],e[0],e[1]))).map(Ot)}function en(e,...t){e&&setTimeout((()=>e(...t)),1)}function tn(e){e.premovable.current&&(e.premovable.current=void 0,en(e.premovable.events.unset))}function nn(e){const t=e.predroppable;t.current&&(t.current=void 0,en(t.events.unset))}function rn(e,t,n){const r=e.pieces.get(t),o=e.pieces.get(n);if(t===n||!r)return!1;const i=o&&o.color!==r.color?o:void 0;return n===e.selected&&hn(e),en(e.events.move,t,n,i),function(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||"king"!==r.role)return!1;const o=Tt(t),i=Tt(n);if(0!==o[1]&&7!==o[1]||o[1]!==i[1])return!1;4!==o[0]||e.pieces.has(n)||(6===i[0]?n=Ot([7,i[1]]):2===i[0]&&(n=Ot([0,i[1]])));const s=e.pieces.get(n);return!(!s||s.color!==r.color||"rook"!==s.role||(e.pieces.delete(t),e.pieces.delete(n),o[0]<i[0]?(e.pieces.set(Ot([6,i[1]]),r),e.pieces.set(Ot([5,i[1]]),s)):(e.pieces.set(Ot([2,i[1]]),r),e.pieces.set(Ot([3,i[1]]),s)),0))}(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,en(e.events.change),i||!0}function on(e,t,n,r){if(e.pieces.has(n)){if(!r)return!1;e.pieces.delete(n)}return en(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,en(e.events.change),e.movable.dests=void 0,e.turnColor=Mt(e.turnColor),!0}function sn(e,t,n){const r=rn(e,t,n);return r&&(e.movable.dests=void 0,e.turnColor=Mt(e.turnColor),e.animation.current=void 0),r}function an(e,t,n){if(pn(e,t,n)){const r=sn(e,t,n);if(r){const o=e.hold.stop();hn(e);const i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return!0!==r&&(i.captured=r),en(e.movable.events.after,t,n,i),!0}}else if(function(e,t,n){return t!==n&&fn(e,t)&&Zt(e.pieces,t,e.premovable.castle).includes(n)}(e,t,n))return function(e,t,n,r){nn(e),e.premovable.current=[t,n],en(e.premovable.events.set,t,n,r)}(e,t,n,{ctrlKey:e.stats.ctrlKey}),hn(e),!0;return hn(e),!1}function cn(e,t,n,r){const o=e.pieces.get(t);o&&(function(e,t,n){const r=e.pieces.get(t);return!(!r||t!==n&&e.pieces.has(n)||"both"!==e.movable.color&&(e.movable.color!==r.color||e.turnColor!==r.color))}(e,t,n)||r)?(e.pieces.delete(t),on(e,o,n,r),en(e.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&function(e,t,n){const r=e.pieces.get(t),o=e.pieces.get(n);return!!r&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}(e,t,n)?function(e,t,n){tn(e),e.predroppable.current={role:t,key:n},en(e.predroppable.events.set,t,n)}(e,o.role,n):(tn(e),nn(e)),e.pieces.delete(t),hn(e)}function ln(e,t,n){if(en(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return hn(e),void e.hold.cancel();if((e.selectable.enabled||n)&&e.selected!==t&&an(e,e.selected,t))return void(e.stats.dragged=!1)}(dn(e,t)||fn(e,t))&&(un(e,t),e.hold.start())}function un(e,t){e.selected=t,fn(e,t)?e.premovable.dests=Zt(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function hn(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function dn(e,t){const n=e.pieces.get(t);return!!n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function pn(e,t,n){var r,o;return t!==n&&dn(e,t)&&(e.movable.free||!!(null===(o=null===(r=e.movable.dests)||void 0===r?void 0:r.get(t))||void 0===o?void 0:o.includes(n)))}function fn(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function mn(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],r=t[1];let o=!1;if(pn(e,n,r)){const t=sn(e,n,r);if(t){const i={premove:!0};!0!==t&&(i.captured=t),en(e.movable.events.after,n,r,i),o=!0}}return tn(e),o}function gn(e){tn(e),nn(e),hn(e)}function vn(e){e.movable.color=e.movable.dests=e.animation.current=void 0,gn(e)}function bn(e,t,n){let r=Math.floor(8*(e[0]-n.left)/n.width);t||(r=7-r);let o=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(o=7-o),r>=0&&r<8&&o>=0&&o<8?Ot([r,o]):void 0}function wn(e){return"white"===e.orientation}const yn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",kn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},En={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function _n(e){"start"===e&&(e=yn);const t=new Map;let n=7,r=0;for(const o of e)switch(o){case" ":case"[":return t;case"/":if(--n,n<0)return t;r=0;break;case"~":{const e=t.get(Ot([r-1,n]));e&&(e.promoted=!0);break}default:{const e=o.charCodeAt(0);if(e<57)r+=e-48;else{const e=o.toLowerCase();t.set(Ot([r,n]),{role:kn[e],color:o===e?"black":"white"}),++r}}}return t}function xn(e,t){t.animation&&(Sn(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Cn(e,t){var n,r;if((null===(n=t.movable)||void 0===n?void 0:n.dests)&&(e.movable.dests=void 0),(null===(r=t.drawable)||void 0===r?void 0:r.autoShapes)&&(e.drawable.autoShapes=[]),Sn(e,t),t.fen&&(e.pieces=_n(t.fen),e.drawable.shapes=[]),"check"in t&&function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(const[n,r]of e.pieces)"king"===r.role&&r.color===t&&(e.check=n)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&un(e,e.selected),xn(e,t),!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?"1":"8",n="e"+t,r=e.movable.dests.get(n),o=e.pieces.get(n);if(!r||!o||"king"!==o.role)return;e.movable.dests.set(n,r.filter((e=>!(e==="a"+t&&r.includes("c"+t)||e==="h"+t&&r.includes("g"+t)))))}}function Sn(e,t){for(const n in t)An(e[n])&&An(t[n])?Sn(e[n],t[n]):e[n]=t[n]}function An(e){return"object"==typeof e}function On(e,t){return t.animation.enabled?function(e,t){const n=new Map(t.pieces),r=e(t),o=function(e,t){const n=new Map,r=[],o=new Map,i=[],s=[],a=new Map;let c,l,u;for(const[t,n]of e)a.set(t,Pn(t,n));for(const e of At)c=t.pieces.get(e),l=a.get(e),c?l?Lt(c,l.piece)||(i.push(l),s.push(Pn(e,c))):s.push(Pn(e,c)):l&&i.push(l);for(const e of s)l=Rn(e,i.filter((t=>Lt(e.piece,t.piece)))),l&&(u=[l.pos[0]-e.pos[0],l.pos[1]-e.pos[1]],n.set(e.key,u.concat(u)),r.push(l.key));for(const e of i)r.includes(e.key)||o.set(e.key,e.piece);return{anims:n,fadings:o}}(n,t);if(o.anims.size||o.fadings.size){const e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:o},e||Mn(t,performance.now())}else t.dom.redraw();return r}(e,t):Tn(e,t)}function Tn(e,t){const n=e(t);return t.dom.redraw(),n}function Pn(e,t){return{key:e,pos:Tt(e),piece:t}}function Rn(e,t){return t.sort(((t,n)=>qt(e.pos,t.pos)-qt(e.pos,n.pos)))[0]}function Mn(e,t){const n=e.animation.current;if(void 0===n)return void(e.dom.destroyed||e.dom.redrawNow());const r=1-(t-n.start)*n.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}(r);for(const e of n.plan.anims.values())e[2]=e[0]*t,e[3]=e[1]*t;e.dom.redrawNow(!0),requestAnimationFrame(((t=performance.now())=>Mn(e,t)))}}const qn=["green","red","blue","yellow"];function Ln(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?hn(e):gn(e);const n=$t(t),r=bn(n,wn(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:n,brush:$n(t),snapToValidMove:e.drawable.defaultSnapToValidMove},jn(e))}function jn(e){requestAnimationFrame((()=>{const t=e.drawable.current;if(t){const n=bn(t.pos,wn(e),e.dom.bounds());n||(t.snapToValidMove=!1);const r=t.snapToValidMove?function(e,t,n,r){const o=Tt(e),i=Pt.filter((e=>Xt(o[0],o[1],e[0],e[1])||Qt(o[0],o[1],e[0],e[1]))),s=i.map((e=>Ht(Ot(e),n,r))).map((e=>qt(t,e))),[,a]=s.reduce(((e,t,n)=>e[0]<t?e:[t,n]),[s[0],0]);return Ot(i[a])}(t.orig,t.pos,wn(e),e.dom.bounds()):n;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),jn(e)}}))}function Dn(e,t){e.drawable.current&&(e.drawable.current.pos=$t(t))}function Nn(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const n=e=>e.orig===t.orig&&e.dest===t.dest,r=e.shapes.find(n);r&&(e.shapes=e.shapes.filter((e=>!n(e))));r&&r.brush===t.brush||e.shapes.push(t);Un(e)}(e.drawable,t),In(e))}function In(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function $n(e){var t;const n=(e.shiftKey||e.ctrlKey)&&Ut(e),r=e.altKey||e.metaKey||(null===(t=e.getModifierState)||void 0===t?void 0:t.call(e,"AltGraph"));return qn[(n?1:0)+(r?2:0)]}function Un(e){e.onChange&&e.onChange(e.shapes)}function Bn(e,t){if(!t.isTrusted||void 0!==t.button&&0!==t.button)return;if(t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),r=$t(t),o=bn(r,wn(e),n);if(!o)return;const i=e.pieces.get(o),s=e.selected;var a;s||!e.drawable.enabled||!e.drawable.eraseOnClick&&i&&i.color===e.turnColor||(a=e).drawable.shapes.length&&(a.drawable.shapes=[],a.dom.redraw(),Un(a.drawable)),!1!==t.cancelable&&(!t.touches||e.blockTouchScroll||i||s||function(e,t){const n=wn(e),r=e.dom.bounds(),o=Math.pow(r.width/8,2);for(const i of e.pieces.keys()){const e=Ht(i,n,r);if(qt(e,t)<=o)return!0}return!1}(e,r))&&t.preventDefault();const c=!!e.premovable.current,l=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&pn(e,e.selected,o)?On((e=>ln(e,o)),e):ln(e,o);const u=e.selected===o,h=Vn(e,o);if(i&&h&&u&&function(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}(e,o)){e.draggable.current={orig:o,piece:i,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:h,previouslySelected:s,originTarget:t.target,keyHasChanged:!1},h.cgDragging=!0,h.classList.add("dragging");const a=e.dom.elements.ghost;a&&(a.className=`ghost ${i.color} ${i.role}`,Dt(a,jt(n)(Tt(o),wn(e))),It(a,!0)),Hn(e)}else c&&tn(e),l&&nn(e);e.dom.redraw()}function Hn(e){requestAnimationFrame((()=>{var t;const n=e.draggable.current;if(!n)return;(null===(t=e.animation.current)||void 0===t?void 0:t.plan.anims.has(n.orig))&&(e.animation.current=void 0);const r=e.pieces.get(n.orig);if(r&&Lt(r,n.piece)){if(!n.started&&qt(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if("function"==typeof n.element){const e=n.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),n.element=e}const t=e.dom.bounds();Dt(n.element,[n.pos[0]-t.left-t.width/16,n.pos[1]-t.top-t.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==bn(n.pos,wn(e),t))}}else Kn(e);Hn(e)}))}function Fn(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=$t(t))}function zn(e,t){const n=e.draggable.current;if(!n)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&n.originTarget!==t.target&&!n.newPiece)return void(e.draggable.current=void 0);tn(e),nn(e);const r=bn($t(t)||n.pos,wn(e),e.dom.bounds());r&&n.started&&n.orig!==r?n.newPiece?cn(e,n.orig,r,n.force):(e.stats.ctrlKey=t.ctrlKey,an(e,n.orig,r)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(n.orig),en(e.events.change)),(n.orig!==n.previouslySelected&&!n.keyHasChanged||n.orig!==r&&r)&&e.selectable.enabled||hn(e),Wn(e),e.draggable.current=void 0,e.dom.redraw()}function Kn(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,hn(e),Wn(e),e.dom.redraw())}function Wn(e){const t=e.dom.elements;t.ghost&&It(t.ghost,!1)}function Vn(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&"PIECE"===n.tagName)return n;n=n.nextSibling}}function Gn(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Qn(e,t){function n(){!function(e){e.orientation=Mt(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}(e),t()}return{set(t){t.orientation&&t.orientation!==e.orientation&&n(),xn(e,t),(t.fen?On:Tn)((e=>Cn(e,t)),e)},state:e,getFen:()=>{return t=e.pieces,St.map((e=>xt.map((n=>{const r=t.get(n+e);if(r){let e=En[r.role];return"white"===r.color&&(e=e.toUpperCase()),r.promoted&&(e+="~"),e}return"1"})).join(""))).join("/").replace(/1{2,}/g,(e=>e.length.toString()));var t},toggleOrientation:n,setPieces(t){On((e=>function(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}(e,t)),e)},selectSquare(t,n){t?On((e=>ln(e,t,n)),e):e.selected&&(hn(e),e.dom.redraw())},move(t,n){On((e=>rn(e,t,n)),e)},newPiece(t,n){On((e=>on(e,t,n)),e)},playPremove(){if(e.premovable.current){if(On(mn,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const n=function(e,t){const n=e.predroppable.current;let r=!1;if(!n)return!1;t(n)&&on(e,{role:n.role,color:e.movable.color},n.key)&&(en(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),r=!0);return nn(e),r}(e,t);return e.dom.redraw(),n}return!1},cancelPremove(){Tn(tn,e)},cancelPredrop(){Tn(nn,e)},cancelMove(){Tn((e=>{gn(e),Kn(e)}),e)},stop(){Tn((e=>{vn(e),Kn(e)}),e)},explode(t){!function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout((()=>{Gn(e,2),setTimeout((()=>Gn(e,void 0)),120)}),120)}(e,t)},setAutoShapes(t){Tn((e=>e.drawable.autoShapes=t),e)},setShapes(t){Tn((e=>e.drawable.shapes=t),e)},getKeyAtDomPos:t=>bn(t,wn(e),e.dom.bounds()),redrawAll:t,dragNewPiece(t,n,r){!function(e,t,n,r){const o="a0";e.pieces.set(o,t),e.dom.redraw();const i=$t(n);e.draggable.current={orig:o,piece:t,origPos:i,pos:i,started:!0,element:()=>Vn(e,o),originTarget:n.target,newPiece:!0,force:!!r,keyHasChanged:!1},Hn(e)}(e,t,n,r)},destroy(){vn(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Yn(e,t,n){const r=new Map,o=[];for(const t of e)r.set(t.hash,!1);let i,s=t.firstChild;for(;s;)i=s.getAttribute("cgHash"),r.has(i)?r.set(i,!0):o.push(s),s=s.nextSibling;for(const e of o)t.removeChild(e);for(const o of e)r.get(o.hash)||t.appendChild(n(o))}function Jn(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Xn(e,t,n){const r=e.drawable,o=r.current,i=o&&o.mouseSq?o:void 0,s=new Map,a=e.dom.bounds(),c=r.autoShapes.filter((e=>!e.piece));for(const e of r.shapes.concat(c).concat(i?[i]:[]))e.dest&&s.set(e.dest,(s.get(e.dest)||0)+1);const l=r.shapes.concat(c).map((e=>({shape:e,current:!1,hash:Zn(e,s,!1,a)})));i&&l.push({shape:i,current:!0,hash:Zn(i,s,!0,a)});const u=l.map((e=>e.hash)).join(";");if(u===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=u;const h=t.querySelector("defs"),d=t.querySelector("g"),p=n.querySelector("g");!function(e,t,n){const r=new Map;let o;for(const n of t)n.shape.dest&&(o=e.brushes[n.shape.brush],n.shape.modifiers&&(o=sr(o,n.shape.modifiers)),r.set(o.key,o));const i=new Set;let s=n.firstChild;for(;s;)i.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[e,t]of r.entries())i.has(e)||n.appendChild(rr(t))}(r,l,h),Yn(l.filter((e=>!e.shape.customSvg)),d,(t=>nr(e,t,r.brushes,s,a))),Yn(l.filter((e=>e.shape.customSvg)),p,(t=>nr(e,t,r.brushes,s,a)))}function Zn({orig:e,dest:t,brush:n,piece:r,modifiers:o,customSvg:i},s,a,c){return[c.width,c.height,a,e,t,n,t&&(s.get(t)||0)>1,r&&er(r),o&&(l=o,""+(l.lineWidth||"")),i&&tr(i)].filter((e=>e)).join(",");var l}function er(e){return[e.color,e.role,e.scale].filter((e=>e)).join(",")}function tr(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function nr(e,{shape:t,current:n,hash:r},o,i,s){let a;const c=ir(Tt(t.orig),e.orientation);if(t.customSvg)a=function(e,t,n){const[r,o]=lr(t,n),i=or(Jn("g"),{transform:`translate(${r},${o})`}),s=or(Jn("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return i.appendChild(s),s.innerHTML=e,i}(t.customSvg,c,s);else if(t.dest){let r=o[t.brush];t.modifiers&&(r=sr(r,t.modifiers)),a=function(e,t,n,r,o,i){const s=function(e){return(e?20:10)/64}(o&&!r),a=lr(t,i),c=lr(n,i),l=c[0]-a[0],u=c[1]-a[1],h=Math.atan2(u,l),d=Math.cos(h)*s,p=Math.sin(h)*s;return or(Jn("line"),{stroke:e.color,"stroke-width":ar(e,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:cr(e,r),x1:a[0],y1:a[1],x2:c[0]-d,y2:c[1]-p})}(r,c,ir(Tt(t.dest),e.orientation),n,(i.get(t.dest)||0)>1,s)}else a=function(e,t,n,r){const o=lr(t,r),i=[3/64,4/64],s=(r.width+r.height)/(4*Math.max(r.width,r.height));return or(Jn("circle"),{stroke:e.color,"stroke-width":i[n?0:1],fill:"none",opacity:cr(e,n),cx:o[0],cy:o[1],r:s-i[1]/2})}(o[t.brush],c,n,s);return a.setAttribute("cgHash",r),a}function rr(e){const t=or(Jn("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(or(Jn("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function or(e,t){for(const n in t)e.setAttribute(n,t[n]);return e}function ir(e,t){return"white"===t?e:[7-e[0],7-e[1]]}function sr(e,t){return{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter((e=>e)).join("")}}function ar(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function cr(e,t){return(e.opacity||1)*(t?.9:1)}function lr(e,t){const n=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*r]}function ur(e,t){const n=Bt("coords",t);let r;for(const t of e)r=Bt("coord"),r.textContent=t,n.appendChild(r);return n}function hr(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),e.viewOnly)return;const r=function(e){return t=>{e.draggable.current?Kn(e):e.drawable.current?In(e):t.shiftKey||Ut(t)?e.drawable.enabled&&Ln(e,t):e.viewOnly||(e.dropmode.active?function(e,t){if(!e.dropmode.active)return;tn(e),nn(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const r=$t(t),o=r&&bn(r,wn(e),e.dom.bounds());o&&cn(e,"a0",o)}e.dom.redraw()}(e,t):Bn(e,t))}}(e);n.addEventListener("touchstart",r,{passive:!1}),n.addEventListener("mousedown",r,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",(e=>e.preventDefault()))}function dr(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function pr(e,t,n){return r=>{e.drawable.current?e.drawable.enabled&&n(e,r):e.viewOnly||t(e,r)}}function fr(e){const t=wn(e),n=jt(e.dom.bounds()),r=e.dom.elements.board,o=e.pieces,i=e.animation.current,s=i?i.plan.anims:new Map,a=i?i.plan.fadings:new Map,c=e.draggable.current,l=function(e){var t;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const t of e.lastMove)kr(n,t,"last-move");e.check&&e.highlight.check&&kr(n,e.check,"check");if(e.selected&&(kr(n,e.selected,"selected"),e.movable.showDests)){const r=null===(t=e.movable.dests)||void 0===t?void 0:t.get(e.selected);if(r)for(const t of r)kr(n,t,"move-dest"+(e.pieces.has(t)?" oc":""));const o=e.premovable.dests;if(o)for(const t of o)kr(n,t,"premove-dest"+(e.pieces.has(t)?" oc":""))}const r=e.premovable.current;if(r)for(const e of r)kr(n,e,"current-premove");else e.predroppable.current&&kr(n,e.predroppable.current.key,"current-premove");const o=e.exploding;if(o)for(const e of o.keys)kr(n,e,"exploding"+o.stage);return n}(e),u=new Set,h=new Set,d=new Map,p=new Map;let f,m,g,v,b,w,y,k,E,_;for(m=r.firstChild;m;){if(f=m.cgKey,gr(m))if(g=o.get(f),b=s.get(f),w=a.get(f),v=m.cgPiece,!m.cgDragging||c&&c.orig===f||(m.classList.remove("dragging"),Dt(m,n(Tt(f),t)),m.cgDragging=!1),!w&&m.cgFading&&(m.cgFading=!1,m.classList.remove("fading")),g){if(b&&m.cgAnimating&&v===yr(g)){const e=Tt(f);e[0]+=b[2],e[1]+=b[3],m.classList.add("anim"),Dt(m,n(e,t))}else m.cgAnimating&&(m.cgAnimating=!1,m.classList.remove("anim"),Dt(m,n(Tt(f),t)),e.addPieceZIndex&&(m.style.zIndex=wr(Tt(f),t)));v!==yr(g)||w&&m.cgFading?w&&v===yr(w)?(m.classList.add("fading"),m.cgFading=!0):Er(d,v,m):u.add(f)}else Er(d,v,m);else if(vr(m)){const e=m.className;l.get(f)===e?h.add(f):Er(p,e,m)}m=m.nextSibling}for(const[e,o]of l)if(!h.has(e)){E=p.get(o),_=E&&E.pop();const i=n(Tt(e),t);if(_)_.cgKey=e,Dt(_,i);else{const t=Bt("square",o);t.cgKey=e,Dt(t,i),r.insertBefore(t,r.firstChild)}}for(const[i,a]of o)if(b=s.get(i),!u.has(i))if(y=d.get(yr(a)),k=y&&y.pop(),k){k.cgKey=i,k.cgFading&&(k.classList.remove("fading"),k.cgFading=!1);const r=Tt(i);e.addPieceZIndex&&(k.style.zIndex=wr(r,t)),b&&(k.cgAnimating=!0,k.classList.add("anim"),r[0]+=b[2],r[1]+=b[3]),Dt(k,n(r,t))}else{const o=yr(a),s=Bt("piece",o),c=Tt(i);s.cgPiece=o,s.cgKey=i,b&&(s.cgAnimating=!0,c[0]+=b[2],c[1]+=b[3]),Dt(s,n(c,t)),e.addPieceZIndex&&(s.style.zIndex=wr(c,t)),r.appendChild(s)}for(const t of d.values())br(e,t);for(const t of p.values())br(e,t)}function mr(e){const t=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,r=t.height/t.width,o=8*Math.floor(t.width*window.devicePixelRatio/8)/window.devicePixelRatio,i=o*r;n.style.width=o+"px",n.style.height=i+"px",e.dom.bounds.clear(),e.addDimensionsCssVars&&(document.documentElement.style.setProperty("--cg-width",o+"px"),document.documentElement.style.setProperty("--cg-height",i+"px"))}function gr(e){return"PIECE"===e.tagName}function vr(e){return"SQUARE"===e.tagName}function br(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function wr(e,t){const n=e[1];return`${t?10-n:3+n}`}function yr(e){return`${e.color} ${e.role}`}function kr(e,t,n){const r=e.get(t);r?e.set(t,`${r} ${n}`):e.set(t,n)}function Er(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function _r(e,t){Yn(e.drawable.autoShapes.filter((e=>e.piece)).map((e=>{return{shape:e,hash:(t=e,[t.orig,null===(n=t.piece)||void 0===n?void 0:n.role,null===(r=t.piece)||void 0===r?void 0:r.color,null===(o=t.piece)||void 0===o?void 0:o.scale].join(",")),current:!1};var t,n,r,o})),t,(t=>function(e,{shape:t,hash:n},r){var o,i,s;const a=t.orig,c=null===(o=t.piece)||void 0===o?void 0:o.role,l=null===(i=t.piece)||void 0===i?void 0:i.color,u=null===(s=t.piece)||void 0===s?void 0:s.scale,h=Bt("piece",`${c} ${l}`);return h.setAttribute("cgHash",n),h.cgKey=a,h.cgScale=u,Nt(h,jt(r)(Tt(a),wn(e)),u),h}(e,t,e.dom.bounds())))}function xr(e,t){const n={pieces:_n(yn),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,addDimensionsCssVars:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:Rt()};function r(){const t="dom"in n?n.dom.unbind:void 0,r=function(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const n of _t)e.classList.toggle("orientation-"+n,t.orientation===n);e.classList.toggle("manipulable",!t.viewOnly);const n=Bt("cg-container");e.appendChild(n);const r=Bt("cg-board");let o,i,s,a;if(n.appendChild(r),t.drawable.visible&&(o=or(Jn("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(Jn("defs")),o.appendChild(Jn("g")),i=or(Jn("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(Jn("g")),s=Bt("cg-auto-pieces"),n.appendChild(o),n.appendChild(i),n.appendChild(s)),t.coordinates){const e="black"===t.orientation?" black":"",r="left"===t.ranksPosition?" left":"";n.appendChild(ur(Ct,"ranks"+e+r)),n.appendChild(ur(xt,"files"+e))}return t.draggable.showGhost&&(a=Bt("piece","ghost"),It(a,!1),n.appendChild(a)),{board:r,container:n,wrap:e,ghost:a,svg:o,customSvg:i,autoPieces:s}}(e,n),o=function(e){let t;const n=()=>(void 0===t&&(t=e()),t);return n.clear=()=>{t=void 0},n}((()=>r.board.getBoundingClientRect())),i=e=>{fr(a),r.autoPieces&&_r(a,r.autoPieces),!e&&r.svg&&Xn(a,r.svg,r.customSvg)},s=()=>{mr(a),function(e){const t=wn(e),n=jt(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(gr(r)&&!r.cgAnimating||vr(r))&&Dt(r,n(Tt(r.cgKey),t)),r=r.nextSibling}(a),r.autoPieces&&function(e){var t;const n=wn(e),r=jt(e.dom.bounds());let o=null===(t=e.dom.elements.autoPieces)||void 0===t?void 0:t.firstChild;for(;o;)Nt(o,r(Tt(o.cgKey),n),o.cgScale),o=o.nextSibling}(a)},a=n;return a.dom={elements:r,bounds:o,redraw:Cr(i),redrawNow:i,unbind:t},a.drawable.prevSvgHash="",mr(a),i(!1),hr(a,s),t||(a.dom.unbind=function(e,t){const n=[];if("ResizeObserver"in window||n.push(dr(document.body,"chessground.resize",t)),!e.viewOnly){const t=pr(e,Fn,Dn),r=pr(e,zn,Nn);for(const e of["touchmove","mousemove"])n.push(dr(document,e,t));for(const e of["touchend","mouseup"])n.push(dr(document,e,r));const o=()=>e.dom.bounds.clear();n.push(dr(document,"scroll",o,{capture:!0,passive:!0})),n.push(dr(window,"resize",o,{passive:!0}))}return()=>n.forEach((e=>e()))}(a,s)),a.events.insert&&a.events.insert(r),a}return Cn(n,t||{}),Qn(r(),r)}function Cr(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame((()=>{e(),t=!1})))}}const Sr=e=>p("div.game-page__board",p("div.cg-wrap",{hook:{insert(t){e.setGround(xr(t.elm,e.chessgroundConfig()))}}},"loading...")),Ar=e=>p("div.btn-group.mt-4",[p("button.btn.btn-secondary",{attrs:{type:"button",disabled:!e.playing()},on:{click(){confirm("Confirm?")&&e.resign()}}},e.chess.fullmoves>1?"Resign":"Abort")]),Or=e=>p("div.game-page__state",e.game.state.status),Tr=(e,t)=>{const n=e.game[t],r=function(e,t){if(!e&&0!==e)return p("span","-");if(2147483647==e)return p("span");const n=e+(t||0);return n>864e5?zt(n):Ft(n)}(e.timeOf(t),t==e.chess.turn&&e.chess.fullmoves>1&&e.playing()?e.lastUpdateAt-Date.now():0);return((e,t,n,r,o,i)=>p("div.game-page__player",{class:{turn:e.chess.turn==t}},[p("div.game-page__player__user",[o&&p("span.game-page__player__user__title.display-5",o),p("span.game-page__player__user__name.display-5",i?`Stockfish level ${i}`:r||"Anon")]),p("div.game-page__player__clock.display-6",n)]))(e,t,r,n.name,n.title,n.aiLevel)},Pr=e=>e.auth.me?Rr(e):Lr(),Rr=e=>[p("div",[p("div.btn-group.mt-5",[p("button.btn.btn-outline-primary.btn-lg",{attrs:{type:"button"},on:{click:()=>e.playPool(10,5)}},"Play a disguised game")]),p("h2.mt-5","Games in progress"),p("div.games",Mr(e.games)),p("h2.mt-5.mb-3","About"),jr()])],Mr=e=>e.games.length?e.games.map(qr):[p("p","No ongoing games at the moment")],qr=e=>p(`a.game-widget.text-decoration-none.game-widget--${e.id}`,{attrs:re(`/game/${e.gameId}`)},[p("span.game-widget__opponent",[p("span.game-widget__opponent__name",e.opponent.username||"Anon")]),p("span.game-widget__board.cg-wrap",{hook:{insert(t){xr(t.elm,{fen:e.fen,orientation:e.color,lastMove:e.lastMove.match(/.{1,2}/g),viewOnly:!0,movable:{free:!1},drawable:{visible:!1},coordinates:!1})}}},"board")]),Lr=()=>[p("div.login.text-center",[jr(),p("div.big",[p("p","Please log in to continue.")]),p("a.btn.btn-primary.btn-lg.mt-5",{attrs:re("/login")},"Login with Lichess")])],jr=()=>p("div.about",[p("p","This is an example for a fully client side OAuth app that uses various Lichess APIs."),p("ul",[p("li",p("a",{attrs:{href:"https://github.com/lichess-org/api-demo"}},"Source code of this demo")),p("li",p("a",{attrs:{href:"https://github.com/lichess-org/api-demo#lichess-oauth-app-demo"}},"README")),p("li",p("a",{attrs:{href:"https://lichess.org/api"}},"Lichess.org API documentation"))]),p("p",["Press ",p("code","<Ctrl+Shift+j>")," to open your browser console and view incoming events.",p("br"),"Check out the network tab as well to view API calls."])]);function Dr(e){return p("body",[p("div.container",Nr(e)(e))])}const Nr=e=>"game"==e.page?e.game?(e=>t=>[p(`div.game-page.game-page--${e.game.id}`,{hook:{destroy:e.onUnmount}},[Tr(e,Mt(e.pov)),Sr(e),Tr(e,e.pov),e.playing()?Ar(e):Or(e)])])(e.game):Ir:"home"==e.page?Pr:"seek"==e.page&&e.seek?(e=>t=>[p("div.seek-page",{hook:{destroy:e.onUnmount}},[p("div.seek-page__awaiting",[Br(),p("span.ms-3","Awaiting a game...")]),p("a.btn.btn-secondary",{attrs:{href:ne("/")}},"Cancel")])])(e.seek):$r,Ir=e=>[Ur()],$r=e=>[p("h1","Not found")],Ur=()=>p("div.loading",Br()),Br=()=>p("div.spinner-border.text-primary",{attrs:{role:"status"}},p("span.visually-hidden","Loading..."));var Hr="top",Fr="bottom",zr="right",Kr="left",Wr="auto",Vr=[Hr,Fr,zr,Kr],Gr="start",Qr="end",Yr="clippingParents",Jr="viewport",Xr="popper",Zr="reference",eo=Vr.reduce((function(e,t){return e.concat([t+"-"+Gr,t+"-"+Qr])}),[]),to=[].concat(Vr,[Wr]).reduce((function(e,t){return e.concat([t,t+"-"+Gr,t+"-"+Qr])}),[]),no="beforeRead",ro="read",oo="afterRead",io="beforeMain",so="main",ao="afterMain",co="beforeWrite",lo="write",uo="afterWrite",ho=[no,ro,oo,io,so,ao,co,lo,uo];function po(e){return e?(e.nodeName||"").toLowerCase():null}function fo(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function mo(e){return e instanceof fo(e).Element||e instanceof Element}function go(e){return e instanceof fo(e).HTMLElement||e instanceof HTMLElement}function vo(e){return"undefined"!=typeof ShadowRoot&&(e instanceof fo(e).ShadowRoot||e instanceof ShadowRoot)}var bo={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},o=t.elements[e];go(o)&&po(o)&&(Object.assign(o.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?o.removeAttribute(e):o.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],o=t.attributes[e]||{},i=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});go(r)&&po(r)&&(Object.assign(r.style,i),Object.keys(o).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]};function wo(e){return e.split("-")[0]}var yo=Math.max,ko=Math.min,Eo=Math.round;function _o(e,t){void 0===t&&(t=!1);var n=e.getBoundingClientRect(),r=1,o=1;if(go(e)&&t){var i=e.offsetHeight,s=e.offsetWidth;s>0&&(r=Eo(n.width)/s||1),i>0&&(o=Eo(n.height)/i||1)}return{width:n.width/r,height:n.height/o,top:n.top/o,right:n.right/r,bottom:n.bottom/o,left:n.left/r,x:n.left/r,y:n.top/o}}function xo(e){var t=_o(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function Co(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&vo(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function So(e){return fo(e).getComputedStyle(e)}function Ao(e){return["table","td","th"].indexOf(po(e))>=0}function Oo(e){return((mo(e)?e.ownerDocument:e.document)||window.document).documentElement}function To(e){return"html"===po(e)?e:e.assignedSlot||e.parentNode||(vo(e)?e.host:null)||Oo(e)}function Po(e){return go(e)&&"fixed"!==So(e).position?e.offsetParent:null}function Ro(e){for(var t=fo(e),n=Po(e);n&&Ao(n)&&"static"===So(n).position;)n=Po(n);return n&&("html"===po(n)||"body"===po(n)&&"static"===So(n).position)?t:n||function(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&go(e)&&"fixed"===So(e).position)return null;var n=To(e);for(vo(n)&&(n=n.host);go(n)&&["html","body"].indexOf(po(n))<0;){var r=So(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(e)||t}function Mo(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function qo(e,t,n){return yo(e,ko(t,n))}function Lo(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function jo(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}var Do={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,r=e.name,o=e.options,i=n.elements.arrow,s=n.modifiersData.popperOffsets,a=wo(n.placement),c=Mo(a),l=[Kr,zr].indexOf(a)>=0?"height":"width";if(i&&s){var u=function(e,t){return Lo("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:jo(e,Vr))}(o.padding,n),h=xo(i),d="y"===c?Hr:Kr,p="y"===c?Fr:zr,f=n.rects.reference[l]+n.rects.reference[c]-s[c]-n.rects.popper[l],m=s[c]-n.rects.reference[c],g=Ro(i),v=g?"y"===c?g.clientHeight||0:g.clientWidth||0:0,b=f/2-m/2,w=u[d],y=v-h[l]-u[p],k=v/2-h[l]/2+b,E=qo(w,k,y),_=c;n.modifiersData[r]=((t={})[_]=E,t.centerOffset=E-k,t)}},effect:function(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&("production"!==process.env.NODE_ENV&&(go(r)||console.error(['Popper: "arrow" element must be an HTMLElement (not an SVGElement).',"To use an SVG arrow, wrap it in an HTMLElement that will be used as","the arrow."].join(" "))),Co(t.elements.popper,r)?t.elements.arrow=r:"production"!==process.env.NODE_ENV&&console.error(['Popper: "arrow" modifier\'s `element` must be a child of the popper',"element."].join(" ")))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function No(e){return e.split("-")[1]}var Io={top:"auto",right:"auto",bottom:"auto",left:"auto"};function $o(e){var t,n=e.popper,r=e.popperRect,o=e.placement,i=e.variation,s=e.offsets,a=e.position,c=e.gpuAcceleration,l=e.adaptive,u=e.roundOffsets,h=e.isFixed,d=s.x,p=void 0===d?0:d,f=s.y,m=void 0===f?0:f,g="function"==typeof u?u({x:p,y:m}):{x:p,y:m};p=g.x,m=g.y;var v=s.hasOwnProperty("x"),b=s.hasOwnProperty("y"),w=Kr,y=Hr,k=window;if(l){var E=Ro(n),_="clientHeight",x="clientWidth";if(E===fo(n)&&"static"!==So(E=Oo(n)).position&&"absolute"===a&&(_="scrollHeight",x="scrollWidth"),E=E,o===Hr||(o===Kr||o===zr)&&i===Qr)y=Fr,m-=(h&&E===k&&k.visualViewport?k.visualViewport.height:E[_])-r.height,m*=c?1:-1;if(o===Kr||(o===Hr||o===Fr)&&i===Qr)w=zr,p-=(h&&E===k&&k.visualViewport?k.visualViewport.width:E[x])-r.width,p*=c?1:-1}var C,S=Object.assign({position:a},l&&Io),A=!0===u?function(e){var t=e.x,n=e.y,r=window.devicePixelRatio||1;return{x:Eo(t*r)/r||0,y:Eo(n*r)/r||0}}({x:p,y:m}):{x:p,y:m};return p=A.x,m=A.y,c?Object.assign({},S,((C={})[y]=b?"0":"",C[w]=v?"0":"",C.transform=(k.devicePixelRatio||1)<=1?"translate("+p+"px, "+m+"px)":"translate3d("+p+"px, "+m+"px, 0)",C)):Object.assign({},S,((t={})[y]=b?m+"px":"",t[w]=v?p+"px":"",t.transform="",t))}var Uo={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,r=n.gpuAcceleration,o=void 0===r||r,i=n.adaptive,s=void 0===i||i,a=n.roundOffsets,c=void 0===a||a;if("production"!==process.env.NODE_ENV){var l=So(t.elements.popper).transitionProperty||"";s&&["transform","top","right","bottom","left"].some((function(e){return l.indexOf(e)>=0}))&&console.warn(["Popper: Detected CSS transitions on at least one of the following",'CSS properties: "transform", "top", "right", "bottom", "left".',"\n\n",'Disable the "computeStyles" modifier\'s `adaptive` option to allow',"for smooth transitions, or remove these properties from the CSS","transition declaration on the popper element if only transitioning","opacity or background-color for example.","\n\n","We recommend using the popper element as a wrapper around an inner","element that can have any CSS property transitioned for animations."].join(" "))}var u={placement:wo(t.placement),variation:No(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:o,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,$o(Object.assign({},u,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:s,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,$o(Object.assign({},u,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},Bo={passive:!0};var Ho={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,r=e.options,o=r.scroll,i=void 0===o||o,s=r.resize,a=void 0===s||s,c=fo(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return i&&l.forEach((function(e){e.addEventListener("scroll",n.update,Bo)})),a&&c.addEventListener("resize",n.update,Bo),function(){i&&l.forEach((function(e){e.removeEventListener("scroll",n.update,Bo)})),a&&c.removeEventListener("resize",n.update,Bo)}},data:{}},Fo={left:"right",right:"left",bottom:"top",top:"bottom"};function zo(e){return e.replace(/left|right|bottom|top/g,(function(e){return Fo[e]}))}var Ko={start:"end",end:"start"};function Wo(e){return e.replace(/start|end/g,(function(e){return Ko[e]}))}function Vo(e){var t=fo(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Go(e){return _o(Oo(e)).left+Vo(e).scrollLeft}function Qo(e){var t=So(e),n=t.overflow,r=t.overflowX,o=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+o+r)}function Yo(e){return["html","body","#document"].indexOf(po(e))>=0?e.ownerDocument.body:go(e)&&Qo(e)?e:Yo(To(e))}function Jo(e,t){var n;void 0===t&&(t=[]);var r=Yo(e),o=r===(null==(n=e.ownerDocument)?void 0:n.body),i=fo(r),s=o?[i].concat(i.visualViewport||[],Qo(r)?r:[]):r,a=t.concat(s);return o?a:a.concat(Jo(To(s)))}function Xo(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Zo(e,t){return t===Jr?Xo(function(e){var t=fo(e),n=Oo(e),r=t.visualViewport,o=n.clientWidth,i=n.clientHeight,s=0,a=0;return r&&(o=r.width,i=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(s=r.offsetLeft,a=r.offsetTop)),{width:o,height:i,x:s+Go(e),y:a}}(e)):mo(t)?function(e){var t=_o(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}(t):Xo(function(e){var t,n=Oo(e),r=Vo(e),o=null==(t=e.ownerDocument)?void 0:t.body,i=yo(n.scrollWidth,n.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),s=yo(n.scrollHeight,n.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),a=-r.scrollLeft+Go(e),c=-r.scrollTop;return"rtl"===So(o||n).direction&&(a+=yo(n.clientWidth,o?o.clientWidth:0)-i),{width:i,height:s,x:a,y:c}}(Oo(e)))}function ei(e,t,n){var r="clippingParents"===t?function(e){var t=Jo(To(e)),n=["absolute","fixed"].indexOf(So(e).position)>=0&&go(e)?Ro(e):e;return mo(n)?t.filter((function(e){return mo(e)&&Co(e,n)&&"body"!==po(e)})):[]}(e):[].concat(t),o=[].concat(r,[n]),i=o[0],s=o.reduce((function(t,n){var r=Zo(e,n);return t.top=yo(r.top,t.top),t.right=ko(r.right,t.right),t.bottom=ko(r.bottom,t.bottom),t.left=yo(r.left,t.left),t}),Zo(e,i));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function ti(e){var t,n=e.reference,r=e.element,o=e.placement,i=o?wo(o):null,s=o?No(o):null,a=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(i){case Hr:t={x:a,y:n.y-r.height};break;case Fr:t={x:a,y:n.y+n.height};break;case zr:t={x:n.x+n.width,y:c};break;case Kr:t={x:n.x-r.width,y:c};break;default:t={x:n.x,y:n.y}}var l=i?Mo(i):null;if(null!=l){var u="y"===l?"height":"width";switch(s){case Gr:t[l]=t[l]-(n[u]/2-r[u]/2);break;case Qr:t[l]=t[l]+(n[u]/2-r[u]/2)}}return t}function ni(e,t){void 0===t&&(t={});var n=t,r=n.placement,o=void 0===r?e.placement:r,i=n.boundary,s=void 0===i?Yr:i,a=n.rootBoundary,c=void 0===a?Jr:a,l=n.elementContext,u=void 0===l?Xr:l,h=n.altBoundary,d=void 0!==h&&h,p=n.padding,f=void 0===p?0:p,m=Lo("number"!=typeof f?f:jo(f,Vr)),g=u===Xr?Zr:Xr,v=e.rects.popper,b=e.elements[d?g:u],w=ei(mo(b)?b:b.contextElement||Oo(e.elements.popper),s,c),y=_o(e.elements.reference),k=ti({reference:y,element:v,strategy:"absolute",placement:o}),E=Xo(Object.assign({},v,k)),_=u===Xr?E:y,x={top:w.top-_.top+m.top,bottom:_.bottom-w.bottom+m.bottom,left:w.left-_.left+m.left,right:_.right-w.right+m.right},C=e.modifiersData.offset;if(u===Xr&&C){var S=C[o];Object.keys(x).forEach((function(e){var t=[zr,Fr].indexOf(e)>=0?1:-1,n=[Hr,Fr].indexOf(e)>=0?"y":"x";x[e]+=S[n]*t}))}return x}function ri(e,t){void 0===t&&(t={});var n=t,r=n.placement,o=n.boundary,i=n.rootBoundary,s=n.padding,a=n.flipVariations,c=n.allowedAutoPlacements,l=void 0===c?to:c,u=No(r),h=u?a?eo:eo.filter((function(e){return No(e)===u})):Vr,d=h.filter((function(e){return l.indexOf(e)>=0}));0===d.length&&(d=h,"production"!==process.env.NODE_ENV&&console.error(["Popper: The `allowedAutoPlacements` option did not allow any","placements. Ensure the `placement` option matches the variation","of the allowed placements.",'For example, "auto" cannot be used to allow "bottom-start".','Use "auto-start" instead.'].join(" ")));var p=d.reduce((function(t,n){return t[n]=ni(e,{placement:n,boundary:o,rootBoundary:i,padding:s})[wo(n)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}var oi={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var o=n.mainAxis,i=void 0===o||o,s=n.altAxis,a=void 0===s||s,c=n.fallbackPlacements,l=n.padding,u=n.boundary,h=n.rootBoundary,d=n.altBoundary,p=n.flipVariations,f=void 0===p||p,m=n.allowedAutoPlacements,g=t.options.placement,v=wo(g),b=c||(v===g||!f?[zo(g)]:function(e){if(wo(e)===Wr)return[];var t=zo(e);return[Wo(e),t,Wo(t)]}(g)),w=[g].concat(b).reduce((function(e,n){return e.concat(wo(n)===Wr?ri(t,{placement:n,boundary:u,rootBoundary:h,padding:l,flipVariations:f,allowedAutoPlacements:m}):n)}),[]),y=t.rects.reference,k=t.rects.popper,E=new Map,_=!0,x=w[0],C=0;C<w.length;C++){var S=w[C],A=wo(S),O=No(S)===Gr,T=[Hr,Fr].indexOf(A)>=0,P=T?"width":"height",R=ni(t,{placement:S,boundary:u,rootBoundary:h,altBoundary:d,padding:l}),M=T?O?zr:Kr:O?Fr:Hr;y[P]>k[P]&&(M=zo(M));var q=zo(M),L=[];if(i&&L.push(R[A]<=0),a&&L.push(R[M]<=0,R[q]<=0),L.every((function(e){return e}))){x=S,_=!1;break}E.set(S,L)}if(_)for(var j=function(e){var t=w.find((function(t){var n=E.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return x=t,"break"},D=f?3:1;D>0;D--){if("break"===j(D))break}t.placement!==x&&(t.modifiersData[r]._skip=!0,t.placement=x,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function ii(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function si(e){return[Hr,zr,Fr,Kr].some((function(t){return e[t]>=0}))}var ai={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,r=t.rects.reference,o=t.rects.popper,i=t.modifiersData.preventOverflow,s=ni(t,{elementContext:"reference"}),a=ni(t,{altBoundary:!0}),c=ii(s,r),l=ii(a,o,i),u=si(c),h=si(l);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:u,hasPopperEscaped:h},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":h})}};var ci={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,r=e.name,o=n.offset,i=void 0===o?[0,0]:o,s=to.reduce((function(e,n){return e[n]=function(e,t,n){var r=wo(e),o=[Kr,Hr].indexOf(r)>=0?-1:1,i="function"==typeof n?n(Object.assign({},t,{placement:e})):n,s=i[0],a=i[1];return s=s||0,a=(a||0)*o,[Kr,zr].indexOf(r)>=0?{x:a,y:s}:{x:s,y:a}}(n,t.rects,i),e}),{}),a=s[t.placement],c=a.x,l=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[r]=s}};var li={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=ti({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};var ui={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name,o=n.mainAxis,i=void 0===o||o,s=n.altAxis,a=void 0!==s&&s,c=n.boundary,l=n.rootBoundary,u=n.altBoundary,h=n.padding,d=n.tether,p=void 0===d||d,f=n.tetherOffset,m=void 0===f?0:f,g=ni(t,{boundary:c,rootBoundary:l,padding:h,altBoundary:u}),v=wo(t.placement),b=No(t.placement),w=!b,y=Mo(v),k="x"===y?"y":"x",E=t.modifiersData.popperOffsets,_=t.rects.reference,x=t.rects.popper,C="function"==typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,S="number"==typeof C?{mainAxis:C,altAxis:C}:Object.assign({mainAxis:0,altAxis:0},C),A=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,O={x:0,y:0};if(E){if(i){var T,P="y"===y?Hr:Kr,R="y"===y?Fr:zr,M="y"===y?"height":"width",q=E[y],L=q+g[P],j=q-g[R],D=p?-x[M]/2:0,N=b===Gr?_[M]:x[M],I=b===Gr?-x[M]:-_[M],$=t.elements.arrow,U=p&&$?xo($):{width:0,height:0},B=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},H=B[P],F=B[R],z=qo(0,_[M],U[M]),K=w?_[M]/2-D-z-H-S.mainAxis:N-z-H-S.mainAxis,W=w?-_[M]/2+D+z+F+S.mainAxis:I+z+F+S.mainAxis,V=t.elements.arrow&&Ro(t.elements.arrow),G=V?"y"===y?V.clientTop||0:V.clientLeft||0:0,Q=null!=(T=null==A?void 0:A[y])?T:0,Y=q+W-Q,J=qo(p?ko(L,q+K-Q-G):L,q,p?yo(j,Y):j);E[y]=J,O[y]=J-q}if(a){var X,Z="x"===y?Hr:Kr,ee="x"===y?Fr:zr,te=E[k],ne="y"===k?"height":"width",re=te+g[Z],oe=te-g[ee],ie=-1!==[Hr,Kr].indexOf(v),se=null!=(X=null==A?void 0:A[k])?X:0,ae=ie?re:te-_[ne]-x[ne]-se+S.altAxis,ce=ie?te+_[ne]+x[ne]-se-S.altAxis:oe,le=p&&ie?function(e,t,n){var r=qo(e,t,n);return r>n?n:r}(ae,te,ce):qo(p?ae:re,te,p?ce:oe);E[k]=le,O[k]=le-te}t.modifiersData[r]=O}},requiresIfExists:["offset"]};function hi(e,t,n){void 0===n&&(n=!1);var r,o,i=go(t),s=go(t)&&function(e){var t=e.getBoundingClientRect(),n=Eo(t.width)/e.offsetWidth||1,r=Eo(t.height)/e.offsetHeight||1;return 1!==n||1!==r}(t),a=Oo(t),c=_o(e,s),l={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(i||!i&&!n)&&(("body"!==po(t)||Qo(a))&&(l=(r=t)!==fo(r)&&go(r)?{scrollLeft:(o=r).scrollLeft,scrollTop:o.scrollTop}:Vo(r)),go(t)?((u=_o(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):a&&(u.x=Go(a))),{x:c.left+l.scrollLeft-u.x,y:c.top+l.scrollTop-u.y,width:c.width,height:c.height}}function di(e){var t=new Map,n=new Set,r=[];function o(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var r=t.get(e);r&&o(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||o(e)})),r}function pi(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return[].concat(n).reduce((function(e,t){return e.replace(/%s/,t)}),e)}var fi='Popper: modifier "%s" provided an invalid %s property, expected %s but got %s',mi=["name","enabled","phase","fn","effect","requires","options"];var gi="Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.",vi={placement:"bottom",modifiers:[],strategy:"absolute"};function bi(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function wi(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,o=t.defaultOptions,i=void 0===o?vi:o;return function(e,t,n){void 0===n&&(n=i);var o,s,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},vi,i),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],l=!1,u={state:a,setOptions:function(n){var o="function"==typeof n?n(a.options):n;h(),a.options=Object.assign({},i,a.options,o),a.scrollParents={reference:mo(e)?Jo(e):e.contextElement?Jo(e.contextElement):[],popper:Jo(t)};var s,l,d,p=function(e){var t=di(e);return ho.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}(function(e){var t=e.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}([].concat(r,a.options.modifiers)));if(a.orderedModifiers=p.filter((function(e){return e.enabled})),"production"!==process.env.NODE_ENV){if(function(e){e.forEach((function(t){[].concat(Object.keys(t),mi).filter((function(e,t,n){return n.indexOf(e)===t})).forEach((function(n){switch(n){case"name":"string"!=typeof t.name&&console.error(pi(fi,String(t.name),'"name"','"string"','"'+String(t.name)+'"'));break;case"enabled":"boolean"!=typeof t.enabled&&console.error(pi(fi,t.name,'"enabled"','"boolean"','"'+String(t.enabled)+'"'));break;case"phase":ho.indexOf(t.phase)<0&&console.error(pi(fi,t.name,'"phase"',"either "+ho.join(", "),'"'+String(t.phase)+'"'));break;case"fn":"function"!=typeof t.fn&&console.error(pi(fi,t.name,'"fn"','"function"','"'+String(t.fn)+'"'));break;case"effect":null!=t.effect&&"function"!=typeof t.effect&&console.error(pi(fi,t.name,'"effect"','"function"','"'+String(t.fn)+'"'));break;case"requires":null==t.requires||Array.isArray(t.requires)||console.error(pi(fi,t.name,'"requires"','"array"','"'+String(t.requires)+'"'));break;case"requiresIfExists":Array.isArray(t.requiresIfExists)||console.error(pi(fi,t.name,'"requiresIfExists"','"array"','"'+String(t.requiresIfExists)+'"'));break;case"options":case"data":break;default:console.error('PopperJS: an invalid property has been provided to the "'+t.name+'" modifier, valid properties are '+mi.map((function(e){return'"'+e+'"'})).join(", ")+'; but "'+n+'" was provided.')}t.requires&&t.requires.forEach((function(n){null==e.find((function(e){return e.name===n}))&&console.error(pi('Popper: modifier "%s" requires "%s", but "%s" modifier is not available',String(t.name),n,n))}))}))}))}((s=[].concat(p,a.options.modifiers),l=function(e){return e.name},d=new Set,s.filter((function(e){var t=l(e);if(!d.has(t))return d.add(t),!0})))),wo(a.options.placement)===Wr)a.orderedModifiers.find((function(e){return"flip"===e.name}))||console.error(['Popper: "auto" placements require the "flip" modifier be',"present and enabled to work."].join(" "));var f=So(t);[f.marginTop,f.marginRight,f.marginBottom,f.marginLeft].some((function(e){return parseFloat(e)}))&&console.warn(['Popper: CSS "margin" styles cannot be used to apply padding',"between the popper and its reference element or boundary.","To replicate margin, use the `offset` modifier, as well as","the `padding` option in the `preventOverflow` and `flip`","modifiers."].join(" "))}return a.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,o=e.effect;if("function"==typeof o){var i=o({state:a,name:t,instance:u,options:r}),s=function(){};c.push(i||s)}})),u.update()},forceUpdate:function(){if(!l){var e=a.elements,t=e.reference,n=e.popper;if(bi(t,n)){a.rects={reference:hi(t,Ro(n),"fixed"===a.options.strategy),popper:xo(n)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0,o=0;o<a.orderedModifiers.length;o++){if("production"!==process.env.NODE_ENV&&(r+=1)>100){console.error("Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.");break}if(!0!==a.reset){var i=a.orderedModifiers[o],s=i.fn,c=i.options,h=void 0===c?{}:c,d=i.name;"function"==typeof s&&(a=s({state:a,options:h,name:d,instance:u})||a)}else a.reset=!1,o=-1}}else"production"!==process.env.NODE_ENV&&console.error(gi)}},update:(o=function(){return new Promise((function(e){u.forceUpdate(),e(a)}))},function(){return s||(s=new Promise((function(e){Promise.resolve().then((function(){s=void 0,e(o())}))}))),s}),destroy:function(){h(),l=!0}};if(!bi(e,t))return"production"!==process.env.NODE_ENV&&console.error(gi),u;function h(){c.forEach((function(e){return e()})),c=[]}return u.setOptions(n).then((function(e){!l&&n.onFirstUpdate&&n.onFirstUpdate(e)})),u}}var yi=wi(),ki=wi({defaultModifiers:[Ho,li,Uo,bo]}),Ei=wi({defaultModifiers:[Ho,li,Uo,bo,ci,oi,ui,Do,ai]}),_i=_(Object.freeze({__proto__:null,popperGenerator:wi,detectOverflow:ni,createPopperBase:yi,createPopper:Ei,createPopperLite:ki,top:Hr,bottom:Fr,right:zr,left:Kr,auto:Wr,basePlacements:Vr,start:Gr,end:Qr,clippingParents:Yr,viewport:Jr,popper:Xr,reference:Zr,variationPlacements:eo,placements:to,beforeRead:no,read:ro,afterRead:oo,beforeMain:io,main:so,afterMain:ao,beforeWrite:co,write:lo,afterWrite:uo,modifierPhases:ho,applyStyles:bo,arrow:Do,computeStyles:Uo,eventListeners:Ho,flip:oi,hide:ai,offset:ci,popperOffsets:li,preventOverflow:ui})),xi={exports:{}};xi.exports=function(){const e=()=>{const{jQuery:e}=window;return e&&!document.body.hasAttribute("data-bs-no-jquery")?e:null},t=/[^.]*(?=\..*)\.|.*/,n=/\..*/,r=/::\d+$/,o={};let i=1;const s={mouseenter:"mouseover",mouseleave:"mouseout"},a=/^(mouseenter|mouseleave)/i,c=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function l(e,t){return t&&`${t}::${i++}`||e.uidEvent||i++}function u(e){const t=l(e);return e.uidEvent=t,o[t]=o[t]||{},o[t]}function h(e,t){return function n(r){return r.delegateTarget=e,n.oneOff&&w.off(e,r.type,t),t.apply(e,[r])}}function d(e,t,n){return function r(o){const i=e.querySelectorAll(t);for(let{target:s}=o;s&&s!==this;s=s.parentNode)for(let a=i.length;a--;)if(i[a]===s)return o.delegateTarget=s,r.oneOff&&w.off(e,o.type,t,n),n.apply(s,[o]);return null}}function p(e,t,n=null){const r=Object.keys(e);for(let o=0,i=r.length;o<i;o++){const i=e[r[o]];if(i.originalHandler===t&&i.delegationSelector===n)return i}return null}function f(e,t,n){const r="string"==typeof t,o=r?n:t;let i=b(e);return c.has(i)||(i=e),[r,o,i]}function m(e,n,r,o,i){if("string"!=typeof n||!e)return;if(r||(r=o,o=null),a.test(n)){const e=e=>function(t){if(!t.relatedTarget||t.relatedTarget!==t.delegateTarget&&!t.delegateTarget.contains(t.relatedTarget))return e.call(this,t)};o?o=e(o):r=e(r)}const[s,c,m]=f(n,r,o),g=u(e),v=g[m]||(g[m]={}),b=p(v,c,s?r:null);if(b)return void(b.oneOff=b.oneOff&&i);const w=l(c,n.replace(t,"")),y=s?d(e,r,o):h(e,r);y.delegationSelector=s?r:null,y.originalHandler=c,y.oneOff=i,y.uidEvent=w,v[w]=y,e.addEventListener(m,y,s)}function g(e,t,n,r,o){const i=p(t[n],r,o);i&&(e.removeEventListener(n,i,Boolean(o)),delete t[n][i.uidEvent])}function v(e,t,n,r){const o=t[n]||{};Object.keys(o).forEach((i=>{if(i.includes(r)){const r=o[i];g(e,t,n,r.originalHandler,r.delegationSelector)}}))}function b(e){return e=e.replace(n,""),s[e]||e}const w={on(e,t,n,r){m(e,t,n,r,!1)},one(e,t,n,r){m(e,t,n,r,!0)},off(e,t,n,o){if("string"!=typeof t||!e)return;const[i,s,a]=f(t,n,o),c=a!==t,l=u(e),h=t.startsWith(".");if(void 0!==s){if(!l||!l[a])return;return void g(e,l,a,s,i?n:null)}h&&Object.keys(l).forEach((n=>{v(e,l,n,t.slice(1))}));const d=l[a]||{};Object.keys(d).forEach((n=>{const o=n.replace(r,"");if(!c||t.includes(o)){const t=d[n];g(e,l,a,t.originalHandler,t.delegationSelector)}}))},trigger(t,n,r){if("string"!=typeof n||!t)return null;const o=e(),i=b(n),s=n!==i,a=c.has(i);let l,u=!0,h=!0,d=!1,p=null;return s&&o&&(l=o.Event(n,r),o(t).trigger(l),u=!l.isPropagationStopped(),h=!l.isImmediatePropagationStopped(),d=l.isDefaultPrevented()),a?(p=document.createEvent("HTMLEvents"),p.initEvent(i,u,!0)):p=new CustomEvent(n,{bubbles:u,cancelable:!0}),void 0!==r&&Object.keys(r).forEach((e=>{Object.defineProperty(p,e,{get:()=>r[e]})})),d&&p.preventDefault(),h&&t.dispatchEvent(p),p.defaultPrevented&&void 0!==l&&l.preventDefault(),p}};return w}();var Ci={exports:{}};!function(e,t){e.exports=function(){function e(e){return"true"===e||"false"!==e&&(e===Number(e).toString()?Number(e):""===e||"null"===e?null:e)}function t(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}return{setDataAttribute(e,n,r){e.setAttribute(`data-bs-${t(n)}`,r)},removeDataAttribute(e,n){e.removeAttribute(`data-bs-${t(n)}`)},getDataAttributes(t){if(!t)return{};const n={};return Object.keys(t.dataset).filter((e=>e.startsWith("bs"))).forEach((r=>{let o=r.replace(/^bs/,"");o=o.charAt(0).toLowerCase()+o.slice(1,o.length),n[o]=e(t.dataset[r])})),n},getDataAttribute:(n,r)=>e(n.getAttribute(`data-bs-${t(r)}`)),offset(e){const t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}},position:e=>({top:e.offsetTop,left:e.offsetLeft})}}()}(Ci);var Si={exports:{}};!function(e,t){e.exports=function(){const e=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),t=t=>!(!e(t)||0===t.getClientRects().length)&&"visible"===getComputedStyle(t).getPropertyValue("visibility"),n=e=>!e||e.nodeType!==Node.ELEMENT_NODE||!!e.classList.contains("disabled")||(void 0!==e.disabled?e.disabled:e.hasAttribute("disabled")&&"false"!==e.getAttribute("disabled")),r=3;return{find:(e,t=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(t,e)),findOne:(e,t=document.documentElement)=>Element.prototype.querySelector.call(t,e),children:(e,t)=>[].concat(...e.children).filter((e=>e.matches(t))),parents(e,t){const n=[];let o=e.parentNode;for(;o&&o.nodeType===Node.ELEMENT_NODE&&o.nodeType!==r;)o.matches(t)&&n.push(o),o=o.parentNode;return n},prev(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return[n];n=n.previousElementSibling}return[]},next(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return[n];n=n.nextElementSibling}return[]},focusableChildren(e){const r=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((e=>`${e}:not([tabindex^="-"])`)).join(", ");return this.find(r,e).filter((e=>!n(e)&&t(e)))}}}()}(Si);var Ai={exports:{}},Oi={exports:{}};!function(e,t){e.exports=function(){const e=new Map;return{set(t,n,r){e.has(t)||e.set(t,new Map);const o=e.get(t);o.has(n)||0===o.size?o.set(n,r):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(o.keys())[0]}.`)},get:(t,n)=>e.has(t)&&e.get(t).get(n)||null,remove(t,n){if(!e.has(t))return;const r=e.get(t);r.delete(n),0===r.size&&e.delete(t)}}}()}(Oi),function(e,t){e.exports=function(e,t){const n=e=>e&&"object"==typeof e&&"default"in e?e:{default:e},r=n(e),o=n(t),i=1e3,s="transitionend",a=e=>{if(!e)return 0;let{transitionDuration:t,transitionDelay:n}=window.getComputedStyle(e);const r=Number.parseFloat(t),o=Number.parseFloat(n);return r||o?(t=t.split(",")[0],n=n.split(",")[0],(Number.parseFloat(t)+Number.parseFloat(n))*i):0},c=e=>{e.dispatchEvent(new Event(s))},l=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),u=e=>l(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(e):null,h=e=>{"function"==typeof e&&e()},d=(e,t,n=!0)=>{if(!n)return void h(e);const r=5,o=a(t)+r;let i=!1;const l=({target:n})=>{n===t&&(i=!0,t.removeEventListener(s,l),h(e))};t.addEventListener(s,l),setTimeout((()=>{i||c(t)}),o)},p="5.1.3";class f{constructor(e){(e=u(e))&&(this._element=e,r.default.set(this._element,this.constructor.DATA_KEY,this))}dispose(){r.default.remove(this._element,this.constructor.DATA_KEY),o.default.off(this._element,this.constructor.EVENT_KEY),Object.getOwnPropertyNames(this).forEach((e=>{this[e]=null}))}_queueCallback(e,t,n=!0){d(e,t,n)}static getInstance(e){return r.default.get(u(e),this.DATA_KEY)}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,"object"==typeof t?t:null)}static get VERSION(){return p}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}}return f}(Oi.exports,xi.exports)}(Ai),function(e,t){e.exports=function(e,t,n,r,o){const i=e=>e&&"object"==typeof e&&"default"in e?e:{default:e};function s(e){if(e&&e.__esModule)return e;const t=Object.create(null);if(e)for(const n in e)if("default"!==n){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}return t.default=e,Object.freeze(t)}const a=s(e),c=i(t),l=i(n),u=i(r),h=i(o),d=e=>null==e?`${e}`:{}.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase(),p=e=>{let t=e.getAttribute("data-bs-target");if(!t||"#"===t){let n=e.getAttribute("href");if(!n||!n.includes("#")&&!n.startsWith("."))return null;n.includes("#")&&!n.startsWith("#")&&(n=`#${n.split("#")[1]}`),t=n&&"#"!==n?n.trim():null}return t},f=e=>{const t=p(e);return t?document.querySelector(t):null},m=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),g=e=>m(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(e):null,v=(e,t,n)=>{Object.keys(n).forEach((r=>{const o=n[r],i=t[r],s=i&&m(i)?"element":d(i);if(!new RegExp(o).test(s))throw new TypeError(`${e.toUpperCase()}: Option "${r}" provided type "${s}" but expected type "${o}".`)}))},b=e=>!(!m(e)||0===e.getClientRects().length)&&"visible"===getComputedStyle(e).getPropertyValue("visibility"),w=e=>!e||e.nodeType!==Node.ELEMENT_NODE||!!e.classList.contains("disabled")||(void 0!==e.disabled?e.disabled:e.hasAttribute("disabled")&&"false"!==e.getAttribute("disabled")),y=()=>{},k=()=>{const{jQuery:e}=window;return e&&!document.body.hasAttribute("data-bs-no-jquery")?e:null},E=[],_=e=>{"loading"===document.readyState?(E.length||document.addEventListener("DOMContentLoaded",(()=>{E.forEach((e=>e()))})),E.push(e)):e()},x=()=>"rtl"===document.documentElement.dir,C=e=>{_((()=>{const t=k();if(t){const n=e.NAME,r=t.fn[n];t.fn[n]=e.jQueryInterface,t.fn[n].Constructor=e,t.fn[n].noConflict=()=>(t.fn[n]=r,e.jQueryInterface)}}))},S=(e,t,n,r)=>{let o=e.indexOf(t);if(-1===o)return e[!n&&r?e.length-1:0];const i=e.length;return o+=n?1:-1,r&&(o=(o+i)%i),e[Math.max(0,Math.min(o,i-1))]},A="dropdown",O=".bs.dropdown",T=".data-api",P="Escape",R="Space",M="Tab",q="ArrowUp",L="ArrowDown",j=2,D=new RegExp(`${q}|${L}|${P}`),N=`hide${O}`,I=`hidden${O}`,$=`show${O}`,U=`shown${O}`,B=`click${O}${T}`,H=`keydown${O}${T}`,F=`keyup${O}${T}`,z="show",K="dropup",W="dropend",V="dropstart",G="navbar",Q='[data-bs-toggle="dropdown"]',Y=".dropdown-menu",J=".navbar-nav",X=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",Z=x()?"top-end":"top-start",ee=x()?"top-start":"top-end",te=x()?"bottom-end":"bottom-start",ne=x()?"bottom-start":"bottom-end",re=x()?"left-start":"right-start",oe=x()?"right-start":"left-start",ie={offset:[0,2],boundary:"clippingParents",reference:"toggle",display:"dynamic",popperConfig:null,autoClose:!0},se={offset:"(array|string|function)",boundary:"(string|element)",reference:"(string|element|object)",display:"string",popperConfig:"(null|object|function)",autoClose:"(boolean|string)"};class ae extends h.default{constructor(e,t){super(e),this._popper=null,this._config=this._getConfig(t),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar()}static get Default(){return ie}static get DefaultType(){return se}static get NAME(){return A}toggle(){return this._isShown()?this.hide():this.show()}show(){if(w(this._element)||this._isShown(this._menu))return;const e={relatedTarget:this._element};if(c.default.trigger(this._element,$,e).defaultPrevented)return;const t=ae.getParentFromElement(this._element);this._inNavbar?l.default.setDataAttribute(this._menu,"popper","none"):this._createPopper(t),"ontouchstart"in document.documentElement&&!t.closest(J)&&[].concat(...document.body.children).forEach((e=>c.default.on(e,"mouseover",y))),this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(z),this._element.classList.add(z),c.default.trigger(this._element,U,e)}hide(){if(w(this._element)||!this._isShown(this._menu))return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){c.default.trigger(this._element,N,e).defaultPrevented||("ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach((e=>c.default.off(e,"mouseover",y))),this._popper&&this._popper.destroy(),this._menu.classList.remove(z),this._element.classList.remove(z),this._element.setAttribute("aria-expanded","false"),l.default.removeDataAttribute(this._menu,"popper"),c.default.trigger(this._element,I,e))}_getConfig(e){if(e={...this.constructor.Default,...l.default.getDataAttributes(this._element),...e},v(A,e,this.constructor.DefaultType),"object"==typeof e.reference&&!m(e.reference)&&"function"!=typeof e.reference.getBoundingClientRect)throw new TypeError(`${A.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(e){if(void 0===a)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let t=this._element;"parent"===this._config.reference?t=e:m(this._config.reference)?t=g(this._config.reference):"object"==typeof this._config.reference&&(t=this._config.reference);const n=this._getPopperConfig(),r=n.modifiers.find((e=>"applyStyles"===e.name&&!1===e.enabled));this._popper=a.createPopper(t,this._menu,n),r&&l.default.setDataAttribute(this._menu,"popper","static")}_isShown(e=this._element){return e.classList.contains(z)}_getMenuElement(){return u.default.next(this._element,Y)[0]}_getPlacement(){const e=this._element.parentNode;if(e.classList.contains(W))return re;if(e.classList.contains(V))return oe;const t="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return e.classList.contains(K)?t?ee:Z:t?ne:te}_detectNavbar(){return null!==this._element.closest(`.${G}`)}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return"static"===this._config.display&&(e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,..."function"==typeof this._config.popperConfig?this._config.popperConfig(e):this._config.popperConfig}}_selectMenuItem({key:e,target:t}){const n=u.default.find(X,this._menu).filter(b);n.length&&S(n,t,e===L,!n.includes(t)).focus()}static jQueryInterface(e){return this.each((function(){const t=ae.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}static clearMenus(e){if(e&&(e.button===j||"keyup"===e.type&&e.key!==M))return;const t=u.default.find(Q);for(let n=0,r=t.length;n<r;n++){const r=ae.getInstance(t[n]);if(!r||!1===r._config.autoClose)continue;if(!r._isShown())continue;const o={relatedTarget:r._element};if(e){const t=e.composedPath(),n=t.includes(r._menu);if(t.includes(r._element)||"inside"===r._config.autoClose&&!n||"outside"===r._config.autoClose&&n)continue;if(r._menu.contains(e.target)&&("keyup"===e.type&&e.key===M||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;"click"===e.type&&(o.clickEvent=e)}r._completeHide(o)}}static getParentFromElement(e){return f(e)||e.parentNode}static dataApiKeydownHandler(e){if(/input|textarea/i.test(e.target.tagName)?e.key===R||e.key!==P&&(e.key!==L&&e.key!==q||e.target.closest(Y)):!D.test(e.key))return;const t=this.classList.contains(z);if(!t&&e.key===P)return;if(e.preventDefault(),e.stopPropagation(),w(this))return;const n=this.matches(Q)?this:u.default.prev(this,Q)[0],r=ae.getOrCreateInstance(n);if(e.key!==P)return e.key===q||e.key===L?(t||r.show(),void r._selectMenuItem(e)):void(t&&e.key!==R||ae.clearMenus());r.hide()}}return c.default.on(document,H,Q,ae.dataApiKeydownHandler),c.default.on(document,H,Y,ae.dataApiKeydownHandler),c.default.on(document,B,ae.clearMenus),c.default.on(document,F,ae.clearMenus),c.default.on(document,B,Q,(function(e){e.preventDefault(),ae.getOrCreateInstance(this).toggle()})),C(ae),ae}(_i,xi.exports,Ci.exports,Si.exports,Ai.exports)}({exports:{}});return function(e,t){e.exports=function(e,t,n,r,o){const i=e=>e&&"object"==typeof e&&"default"in e?e:{default:e},s=i(e),a=i(t),c=i(n),l=i(r),u=i(o),h=e=>null==e?`${e}`:{}.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase(),d=e=>{let t=e.getAttribute("data-bs-target");if(!t||"#"===t){let n=e.getAttribute("href");if(!n||!n.includes("#")&&!n.startsWith("."))return null;n.includes("#")&&!n.startsWith("#")&&(n=`#${n.split("#")[1]}`),t=n&&"#"!==n?n.trim():null}return t},p=e=>{const t=d(e);return t&&document.querySelector(t)?t:null},f=e=>{const t=d(e);return t?document.querySelector(t):null},m=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),g=e=>m(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(e):null,v=(e,t,n)=>{Object.keys(n).forEach((r=>{const o=n[r],i=t[r],s=i&&m(i)?"element":h(i);if(!new RegExp(o).test(s))throw new TypeError(`${e.toUpperCase()}: Option "${r}" provided type "${s}" but expected type "${o}".`)}))},b=e=>{e.offsetHeight},w=()=>{const{jQuery:e}=window;return e&&!document.body.hasAttribute("data-bs-no-jquery")?e:null},y=[],k=e=>{"loading"===document.readyState?(y.length||document.addEventListener("DOMContentLoaded",(()=>{y.forEach((e=>e()))})),y.push(e)):e()},E=e=>{k((()=>{const t=w();if(t){const n=e.NAME,r=t.fn[n];t.fn[n]=e.jQueryInterface,t.fn[n].Constructor=e,t.fn[n].noConflict=()=>(t.fn[n]=r,e.jQueryInterface)}}))},_="collapse",x="bs.collapse",C=`.${x}`,S={toggle:!0,parent:null},A={toggle:"boolean",parent:"(null|element)"},O=`show${C}`,T=`shown${C}`,P=`hide${C}`,R=`hidden${C}`,M=`click${C}.data-api`,q="show",L="collapse",j="collapsing",D="collapsed",N=`:scope .${L} .${L}`,I="collapse-horizontal",$="width",U="height",B=".collapse.show, .collapse.collapsing",H='[data-bs-toggle="collapse"]';class F extends u.default{constructor(e,t){super(e),this._isTransitioning=!1,this._config=this._getConfig(t),this._triggerArray=[];const n=l.default.find(H);for(let e=0,t=n.length;e<t;e++){const t=n[e],r=p(t),o=l.default.find(r).filter((e=>e===this._element));null!==r&&o.length&&(this._selector=r,this._triggerArray.push(t))}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return S}static get NAME(){return _}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let e,t=[];if(this._config.parent){const e=l.default.find(N,this._config.parent);t=l.default.find(B,this._config.parent).filter((t=>!e.includes(t)))}const n=l.default.findOne(this._selector);if(t.length){const r=t.find((e=>n!==e));if(e=r?F.getInstance(r):null,e&&e._isTransitioning)return}if(a.default.trigger(this._element,O).defaultPrevented)return;t.forEach((t=>{n!==t&&F.getOrCreateInstance(t,{toggle:!1}).hide(),e||s.default.set(t,x,null)}));const r=this._getDimension();this._element.classList.remove(L),this._element.classList.add(j),this._element.style[r]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const o=()=>{this._isTransitioning=!1,this._element.classList.remove(j),this._element.classList.add(L,q),this._element.style[r]="",a.default.trigger(this._element,T)},i=`scroll${r[0].toUpperCase()+r.slice(1)}`;this._queueCallback(o,this._element,!0),this._element.style[r]=`${this._element[i]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(a.default.trigger(this._element,P).defaultPrevented)return;const e=this._getDimension();this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,b(this._element),this._element.classList.add(j),this._element.classList.remove(L,q);const t=this._triggerArray.length;for(let e=0;e<t;e++){const t=this._triggerArray[e],n=f(t);n&&!this._isShown(n)&&this._addAriaAndCollapsedClass([t],!1)}this._isTransitioning=!0;const n=()=>{this._isTransitioning=!1,this._element.classList.remove(j),this._element.classList.add(L),a.default.trigger(this._element,R)};this._element.style[e]="",this._queueCallback(n,this._element,!0)}_isShown(e=this._element){return e.classList.contains(q)}_getConfig(e){return(e={...S,...c.default.getDataAttributes(this._element),...e}).toggle=Boolean(e.toggle),e.parent=g(e.parent),v(_,e,A),e}_getDimension(){return this._element.classList.contains(I)?$:U}_initializeChildren(){if(!this._config.parent)return;const e=l.default.find(N,this._config.parent);l.default.find(H,this._config.parent).filter((t=>!e.includes(t))).forEach((e=>{const t=f(e);t&&this._addAriaAndCollapsedClass([e],this._isShown(t))}))}_addAriaAndCollapsedClass(e,t){e.length&&e.forEach((e=>{t?e.classList.remove(D):e.classList.add(D),e.setAttribute("aria-expanded",t)}))}static jQueryInterface(e){return this.each((function(){const t={};"string"==typeof e&&/show|hide/.test(e)&&(t.toggle=!1);const n=F.getOrCreateInstance(this,t);if("string"==typeof e){if(void 0===n[e])throw new TypeError(`No method named "${e}"`);n[e]()}}))}}return a.default.on(document,M,H,(function(e){("A"===e.target.tagName||e.delegateTarget&&"A"===e.delegateTarget.tagName)&&e.preventDefault();const t=p(this);l.default.find(t).forEach((e=>{F.getOrCreateInstance(e,{toggle:!1}).toggle()}))})),E(F),F}(Oi.exports,xi.exports,Ci.exports,Si.exports,Ai.exports)}({exports:{}}),async function(e){const t=h([m,k,v]),n=new Et((function(){r=t(r,Dr(n))}));let r=t(e,Ur());await n.auth.init(),function(e){Z.base(te),Z("/",(async t=>{t.querystring.includes("code=liu_")&&history.pushState({},"",te||"/"),await e.openHome()})),Z("/login",(async t=>{if(e.auth.me)return Z("/");await e.auth.login()})),Z("/logout",(async t=>{await e.auth.logout(),location.href=te})),Z("/game/:id",(t=>{e.openGame(t.params.id)})),Z({hashbang:!0})}(n)}}();
